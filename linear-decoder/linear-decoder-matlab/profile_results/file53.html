<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252" /><link rel="stylesheet" href="file:///C:\Program Files\MATLAB\R2012b\toolbox\matlab\codetools\matlab-report-styles.css" type="text/css" /><title>Function details for minFunc</title><link rel="stylesheet" href="file:///C:\Program Files\MATLAB\R2012b\toolbox\matlab\codetools\matlab-report-styles.css" type="text/css" /></head><body bgcolor="#F8F8F8"><strong>This is a static copy of a profile report</strong><p><a href="file0.html">Home</a><p><span style="font-size:14pt; background:#FFE4B0">minFunc (1 call, 2034.590 sec)</span><br/><i>Generated 27-Nov-2013 14:38:43 using cpu time.</i><br/>function in file C:\Users\Raingo\Desktop\advaced-ml\UFLDL\linear-decoder\minFunc\minFunc.m<br/>Copy to new window for comparing multiple runs<div class="grayline"/><div class="grayline"/><strong>Parents</strong> (calling functions)<br/><p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Name</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Type</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td></tr><tr><td class="td-linebottomrt"><a href="file1.html">linearDecoderExercise</a></td><td class="td-linebottomrt">script</td><td class="td-linebottomrt">1</td></tr></table><div class="grayline"/><strong>Lines where the most time was spent</strong><br/> <p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Line Number</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Code</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Total Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">% Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Time Plot</td></tr><tr><td class="td-linebottomrt"><a href="#Line1044">1044</a></td><td class="td-linebottomrt"><pre>[t,f,g,LSfunEvals] = WolfeLine...</pre></td><td class="td-linebottomrt">400</td><td class="td-linebottomrt">1874.195 s</td><td class="td-linebottomrt" class="td-linebottomrt">92.1%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2012b\toolbox\matlab\codetools\private\one-pixel.gif" width=92 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line559">559</a></td><td class="td-linebottomrt"><pre>d = lbfgsC(-g,old_dirs,old_stp...</pre></td><td class="td-linebottomrt">399</td><td class="td-linebottomrt">78.283 s</td><td class="td-linebottomrt" class="td-linebottomrt">3.8%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2012b\toolbox\matlab\codetools\private\one-pixel.gif" width=4 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line555">555</a></td><td class="td-linebottomrt"><pre>[old_dirs,old_stps,Hdiag] = lb...</pre></td><td class="td-linebottomrt">399</td><td class="td-linebottomrt">75.259 s</td><td class="td-linebottomrt" class="td-linebottomrt">3.7%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2012b\toolbox\matlab\codetools\private\one-pixel.gif" width=4 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line309">309</a></td><td class="td-linebottomrt"><pre>[f,g] = feval(funObj, x, varar...</pre></td><td class="td-linebottomrt">1</td><td class="td-linebottomrt">4.014 s</td><td class="td-linebottomrt" class="td-linebottomrt">0.2%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2012b\toolbox\matlab\codetools\private\one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line938">938</a></td><td class="td-linebottomrt"><pre>if ~isLegal(d)</pre></td><td class="td-linebottomrt">400</td><td class="td-linebottomrt">0.699 s</td><td class="td-linebottomrt" class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2012b\toolbox\matlab\codetools\private\one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt">All other lines</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">2.140 s</td><td class="td-linebottomrt">0.1%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2012b\toolbox\matlab\codetools\private\one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Totals</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">2034.590 s</td><td class="td-linebottomrt" bgcolor="#F0F0F0">100%</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td></tr></table><div class="grayline"/><b>Children</b> (called functions)<br/><p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Name</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Type</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Total Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">% Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Time Plot</td></tr><tr><td class="td-linebottomrt"><a href="file54.html">WolfeLineSearch</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">400</td><td class="td-linebottomrt">1874.149 s</td><td class="td-linebottomrt">92.1%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2012b\toolbox\matlab\codetools\private\one-pixel.gif" width=92 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file60.html">lbfgsC</a></td><td class="td-linebottomrt">MEX-file</td><td class="td-linebottomrt">399</td><td class="td-linebottomrt">77.961 s</td><td class="td-linebottomrt">3.8%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2012b\toolbox\matlab\codetools\private\one-pixel.gif" width=4 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file59.html">lbfgsUpdate</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">399</td><td class="td-linebottomrt">74.703 s</td><td class="td-linebottomrt">3.7%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2012b\toolbox\matlab\codetools\private\one-pixel.gif" width=4 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file10.html">...ze,lambda,sparsityParam,beta,patches)</a></td><td class="td-linebottomrt">anonymous function</td><td class="td-linebottomrt">1</td><td class="td-linebottomrt">4.014 s</td><td class="td-linebottomrt">0.2%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2012b\toolbox\matlab\codetools\private\one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file55.html">isLegal</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">400</td><td class="td-linebottomrt">0.685 s</td><td class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2012b\toolbox\matlab\codetools\private\one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file52.html">minFunc_processInputOptions</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">1</td><td class="td-linebottomrt">0.083 s</td><td class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2012b\toolbox\matlab\codetools\private\one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt">Self time (built-ins, overhead, etc.)</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">2.995 s</td><td class="td-linebottomrt">0.1%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2012b\toolbox\matlab\codetools\private\one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Totals</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">2034.590 s</td><td class="td-linebottomrt" bgcolor="#F0F0F0">100%</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td></tr></table><div class="grayline"/><strong>Code Analyzer results</strong><br/><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Line number</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Message</td></tr><tr><td class="td-linebottomrt"><a href="#Line312">312</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'computeHessian' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line322">322</a></td><td class="td-linebottomrt"><span class="mono">The value assigned here to 'f2' appears to be unused. Consider replacing it by ~.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line327">327</a></td><td class="td-linebottomrt"><span class="mono">Terminate statement with semicolon to suppress output (in functions).</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line328">328</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'diff' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line328">328</a></td><td class="td-linebottomrt"><span class="mono">Terminate statement with semicolon to suppress output (in functions).</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line334">334</a></td><td class="td-linebottomrt"><span class="mono">The value assigned here to 'f2' appears to be unused. Consider replacing it by ~.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line334">334</a></td><td class="td-linebottomrt"><span class="mono">The value assigned here to 'g2' appears to be unused. Consider replacing it by ~.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line338">338</a></td><td class="td-linebottomrt"><span class="mono">Terminate statement with semicolon to suppress output (in functions).</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line339">339</a></td><td class="td-linebottomrt"><span class="mono">Terminate statement with semicolon to suppress output (in functions).</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line340">340</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'diff' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line340">340</a></td><td class="td-linebottomrt"><span class="mono">Terminate statement with semicolon to suppress output (in functions).</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line440">440</a></td><td class="td-linebottomrt"><span class="mono">The variable 'v' appears to change size on every loop iteration. Consider preallocating for speed.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line480">480</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'beta' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line535">535</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'beta' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line653">653</a></td><td class="td-linebottomrt"><span class="mono">Parenthesize the multiplication of 'y' and its transpose to ensure the result is Hermitian.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line653">653</a></td><td class="td-linebottomrt"><span class="mono">Parenthesize the multiplication of 'v' and its transpose to ensure the result is Hermitian.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line678">678</a></td><td class="td-linebottomrt"><span class="mono">Parenthesize the multiplication of 'y' and its transpose to ensure the result is Hermitian.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line678">678</a></td><td class="td-linebottomrt"><span class="mono">Parenthesize the multiplication of 'v' and its transpose to ensure the result is Hermitian.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line728">728</a></td><td class="td-linebottomrt"><span class="mono">{ A{:} B } can often be replaced by [ A {B}], which can be much faster.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line737">737</a></td><td class="td-linebottomrt"><span class="mono">{ A{:} B } can often be replaced by [ A {B}], which can be much faster.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line741">741</a></td><td class="td-linebottomrt"><span class="mono">{ A{:} B } can often be replaced by [ A {B}], which can be much faster.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line795">795</a></td><td class="td-linebottomrt"><span class="mono">Best practice is to separate output variables with commas.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line795">795</a></td><td class="td-linebottomrt"><span class="mono">Best practice is to separate output variables with commas.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line797">797</a></td><td class="td-linebottomrt"><span class="mono">Best practice is to separate output variables with commas.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line797">797</a></td><td class="td-linebottomrt"><span class="mono">Best practice is to separate output variables with commas.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line810">810</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'junk' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line810">810</a></td><td class="td-linebottomrt"><span class="mono">Best practice is to separate output variables with commas.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line835">835</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'D' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line886">886</a></td><td class="td-linebottomrt"><span class="mono">CHOLINC will be removed in a future release. Use ICHOL instead.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line888">888</a></td><td class="td-linebottomrt"><span class="mono">CHOLINC will be removed in a future release. Use ICHOL instead.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line900">900</a></td><td class="td-linebottomrt"><span class="mono">{ A{:} B } can often be replaced by [ A {B}], which can be much faster.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line912">912</a></td><td class="td-linebottomrt"><span class="mono">The value assigned here to 'junk1' appears to be unused. Consider replacing it by ~.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line912">912</a></td><td class="td-linebottomrt"><span class="mono">The value assigned here to 'junk2' appears to be unused. Consider replacing it by ~.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line912">912</a></td><td class="td-linebottomrt"><span class="mono">Best practice is to separate output variables with commas.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line912">912</a></td><td class="td-linebottomrt"><span class="mono">The value assigned here to 'junk3' appears to be unused. Consider replacing it by ~.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line912">912</a></td><td class="td-linebottomrt"><span class="mono">Best practice is to separate output variables with commas.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line912">912</a></td><td class="td-linebottomrt"><span class="mono">Best practice is to separate output variables with commas.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line915">915</a></td><td class="td-linebottomrt"><span class="mono">The value assigned here to 'junk1' appears to be unused. Consider replacing it by ~.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line915">915</a></td><td class="td-linebottomrt"><span class="mono">The value assigned here to 'junk2' appears to be unused. Consider replacing it by ~.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line915">915</a></td><td class="td-linebottomrt"><span class="mono">Best practice is to separate output variables with commas.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line915">915</a></td><td class="td-linebottomrt"><span class="mono">The value assigned here to 'junk3' appears to be unused. Consider replacing it by ~.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line915">915</a></td><td class="td-linebottomrt"><span class="mono">Best practice is to separate output variables with commas.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line915">915</a></td><td class="td-linebottomrt"><span class="mono">Best practice is to separate output variables with commas.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line999">999</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'f_old' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line1051">1051</a></td><td class="td-linebottomrt"><span class="mono">The value assigned here to 'fPrime_new' appears to be unused. Consider replacing it by ~.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line1051">1051</a></td><td class="td-linebottomrt"><span class="mono">The value assigned here to 'LSexitFlag' appears to be unused. Consider replacing it by ~.</span></td></tr></table><div class="grayline"/><strong>Coverage results</strong><br/>Show coverage for parent directory <br/><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Total lines in function</td><td class="td-linebottomrt">1144</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Non-code lines (comments, blank lines)</td><td class="td-linebottomrt">432</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines (lines that can run)</td><td class="td-linebottomrt">712</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines that did run</td><td class="td-linebottomrt">104</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines that did not run</td><td class="td-linebottomrt">608</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Coverage (did run/can run)</td><td class="td-linebottomrt">14.61 %</td></tr></table><div class="grayline"/><b>Function listing</b><br/><pre> <span style="color: #FF0000; font-weight: bold; text-decoration: none">  time</span> <span style="color: #0000FF; font-weight: bold; text-decoration: none">  calls</span>  <span style="font-weight: bold; text-decoration: none">line</span><br/>               <span style="color: #A0A0A0">   1</span> <span style="color: #A0A0A0; background: #FFFFFF;">function [x,f,exitflag,output] = minFunc(funObj,x0,options,varargin)</span><br/>               <span style="color: #A0A0A0">   2</span> <span style="color: #228B22; background: #FFFFFF;">% minFunc(funObj,x0,options,varargin)</span><br/>               <span style="color: #A0A0A0">   3</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">   4</span> <span style="color: #228B22; background: #FFFFFF;">% Unconstrained optimizer using a line search strategy</span><br/>               <span style="color: #A0A0A0">   5</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">   6</span> <span style="color: #228B22; background: #FFFFFF;">% Uses an interface very similar to fminunc</span><br/>               <span style="color: #A0A0A0">   7</span> <span style="color: #228B22; background: #FFFFFF;">%   (it doesn't support all of the optimization toolbox options,</span><br/>               <span style="color: #A0A0A0">   8</span> <span style="color: #228B22; background: #FFFFFF;">%       but supports many other options).</span><br/>               <span style="color: #A0A0A0">   9</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  10</span> <span style="color: #228B22; background: #FFFFFF;">% It computes descent directions using one of ('Method'):</span><br/>               <span style="color: #A0A0A0">  11</span> <span style="color: #228B22; background: #FFFFFF;">%   - 'sd': Steepest Descent</span><br/>               <span style="color: #A0A0A0">  12</span> <span style="color: #228B22; background: #FFFFFF;">%       (no previous information used, not recommended)</span><br/>               <span style="color: #A0A0A0">  13</span> <span style="color: #228B22; background: #FFFFFF;">%   - 'csd': Cyclic Steepest Descent</span><br/>               <span style="color: #A0A0A0">  14</span> <span style="color: #228B22; background: #FFFFFF;">%       (uses previous step length for a fixed length cycle)</span><br/>               <span style="color: #A0A0A0">  15</span> <span style="color: #228B22; background: #FFFFFF;">%   - 'bb': Barzilai and Borwein Gradient</span><br/>               <span style="color: #A0A0A0">  16</span> <span style="color: #228B22; background: #FFFFFF;">%       (uses only previous step)</span><br/>               <span style="color: #A0A0A0">  17</span> <span style="color: #228B22; background: #FFFFFF;">%   - 'cg': Non-Linear Conjugate Gradient</span><br/>               <span style="color: #A0A0A0">  18</span> <span style="color: #228B22; background: #FFFFFF;">%       (uses only previous step and a vector beta)</span><br/>               <span style="color: #A0A0A0">  19</span> <span style="color: #228B22; background: #FFFFFF;">%   - 'scg': Scaled Non-Linear Conjugate Gradient</span><br/>               <span style="color: #A0A0A0">  20</span> <span style="color: #228B22; background: #FFFFFF;">%       (uses previous step and a vector beta, </span><br/>               <span style="color: #A0A0A0">  21</span> <span style="color: #228B22; background: #FFFFFF;">%           and Hessian-vector products to initialize line search)</span><br/>               <span style="color: #A0A0A0">  22</span> <span style="color: #228B22; background: #FFFFFF;">%   - 'pcg': Preconditionined Non-Linear Conjugate Gradient</span><br/>               <span style="color: #A0A0A0">  23</span> <span style="color: #228B22; background: #FFFFFF;">%       (uses only previous step and a vector beta, preconditioned version)</span><br/>               <span style="color: #A0A0A0">  24</span> <span style="color: #228B22; background: #FFFFFF;">%   - 'lbfgs': Quasi-Newton with Limited-Memory BFGS Updating</span><br/>               <span style="color: #A0A0A0">  25</span> <span style="color: #228B22; background: #FFFFFF;">%       (default: uses a predetermined nunber of previous steps to form a </span><br/>               <span style="color: #A0A0A0">  26</span> <span style="color: #228B22; background: #FFFFFF;">%           low-rank Hessian approximation)</span><br/>               <span style="color: #A0A0A0">  27</span> <span style="color: #228B22; background: #FFFFFF;">%   - 'newton0': Hessian-Free Newton</span><br/>               <span style="color: #A0A0A0">  28</span> <span style="color: #228B22; background: #FFFFFF;">%       (numerically computes Hessian-Vector products)</span><br/>               <span style="color: #A0A0A0">  29</span> <span style="color: #228B22; background: #FFFFFF;">%   - 'pnewton0': Preconditioned Hessian-Free Newton </span><br/>               <span style="color: #A0A0A0">  30</span> <span style="color: #228B22; background: #FFFFFF;">%       (numerically computes Hessian-Vector products, preconditioned</span><br/>               <span style="color: #A0A0A0">  31</span> <span style="color: #228B22; background: #FFFFFF;">%       version)</span><br/>               <span style="color: #A0A0A0">  32</span> <span style="color: #228B22; background: #FFFFFF;">%   - 'qnewton': Quasi-Newton Hessian approximation</span><br/>               <span style="color: #A0A0A0">  33</span> <span style="color: #228B22; background: #FFFFFF;">%       (uses dense Hessian approximation)</span><br/>               <span style="color: #A0A0A0">  34</span> <span style="color: #228B22; background: #FFFFFF;">%   - 'mnewton': Newton's method with Hessian calculation after every</span><br/>               <span style="color: #A0A0A0">  35</span> <span style="color: #228B22; background: #FFFFFF;">%   user-specified number of iterations</span><br/>               <span style="color: #A0A0A0">  36</span> <span style="color: #228B22; background: #FFFFFF;">%       (needs user-supplied Hessian matrix)</span><br/>               <span style="color: #A0A0A0">  37</span> <span style="color: #228B22; background: #FFFFFF;">%   - 'newton': Newton's method with Hessian calculation every iteration</span><br/>               <span style="color: #A0A0A0">  38</span> <span style="color: #228B22; background: #FFFFFF;">%       (needs user-supplied Hessian matrix)</span><br/>               <span style="color: #A0A0A0">  39</span> <span style="color: #228B22; background: #FFFFFF;">%   - 'tensor': Tensor</span><br/>               <span style="color: #A0A0A0">  40</span> <span style="color: #228B22; background: #FFFFFF;">%       (needs user-supplied Hessian matrix and Tensor of 3rd partial derivatives)</span><br/>               <span style="color: #A0A0A0">  41</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  42</span> <span style="color: #228B22; background: #FFFFFF;">% Several line search strategies are available for finding a step length satisfying</span><br/>               <span style="color: #A0A0A0">  43</span> <span style="color: #228B22; background: #FFFFFF;">%   the termination criteria ('LS'):</span><br/>               <span style="color: #A0A0A0">  44</span> <span style="color: #228B22; background: #FFFFFF;">%   - 0: Backtrack w/ Step Size Halving</span><br/>               <span style="color: #A0A0A0">  45</span> <span style="color: #228B22; background: #FFFFFF;">%   - 1: Backtrack w/ Quadratic/Cubic Interpolation from new function values</span><br/>               <span style="color: #A0A0A0">  46</span> <span style="color: #228B22; background: #FFFFFF;">%   - 2: Backtrack w/ Cubic Interpolation from new function + gradient</span><br/>               <span style="color: #A0A0A0">  47</span> <span style="color: #228B22; background: #FFFFFF;">%   values (default for 'bb' and 'sd')</span><br/>               <span style="color: #A0A0A0">  48</span> <span style="color: #228B22; background: #FFFFFF;">%   - 3: Bracketing w/ Step Size Doubling and Bisection</span><br/>               <span style="color: #A0A0A0">  49</span> <span style="color: #228B22; background: #FFFFFF;">%   - 4: Bracketing w/ Cubic Interpolation/Extrapolation with function +</span><br/>               <span style="color: #A0A0A0">  50</span> <span style="color: #228B22; background: #FFFFFF;">%   gradient values (default for all except 'bb' and 'sd')</span><br/>               <span style="color: #A0A0A0">  51</span> <span style="color: #228B22; background: #FFFFFF;">%   - 5: Bracketing w/ Mixed Quadratic/Cubic Interpolation/Extrapolation</span><br/>               <span style="color: #A0A0A0">  52</span> <span style="color: #228B22; background: #FFFFFF;">%   - 6: Use Matlab Optimization Toolbox's line search</span><br/>               <span style="color: #A0A0A0">  53</span> <span style="color: #228B22; background: #FFFFFF;">%           (requires Matlab's linesearch.m to be added to the path)</span><br/>               <span style="color: #A0A0A0">  54</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  55</span> <span style="color: #228B22; background: #FFFFFF;">%   Above, the first three find a point satisfying the Armijo conditions,</span><br/>               <span style="color: #A0A0A0">  56</span> <span style="color: #228B22; background: #FFFFFF;">%   while the last four search for find a point satisfying the Wolfe</span><br/>               <span style="color: #A0A0A0">  57</span> <span style="color: #228B22; background: #FFFFFF;">%   conditions.  If the objective function overflows, it is recommended</span><br/>               <span style="color: #A0A0A0">  58</span> <span style="color: #228B22; background: #FFFFFF;">%   to use one of the first 3.</span><br/>               <span style="color: #A0A0A0">  59</span> <span style="color: #228B22; background: #FFFFFF;">%   The first three can be used to perform a non-monotone</span><br/>               <span style="color: #A0A0A0">  60</span> <span style="color: #228B22; background: #FFFFFF;">%   linesearch by changing the option 'Fref'.</span><br/>               <span style="color: #A0A0A0">  61</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  62</span> <span style="color: #228B22; background: #FFFFFF;">% Several strategies for choosing the initial step size are avaiable ('LS_init'):</span><br/>               <span style="color: #A0A0A0">  63</span> <span style="color: #228B22; background: #FFFFFF;">%   - 0: Always try an initial step length of 1 (default for all except 'cg' and 'sd')</span><br/>               <span style="color: #A0A0A0">  64</span> <span style="color: #228B22; background: #FFFFFF;">%       (t = 1)</span><br/>               <span style="color: #A0A0A0">  65</span> <span style="color: #228B22; background: #FFFFFF;">%   - 1: Use a step similar to the previous step (default for 'cg' and 'sd')</span><br/>               <span style="color: #A0A0A0">  66</span> <span style="color: #228B22; background: #FFFFFF;">%       (t = t_old*min(2,g'd/g_old'd_old))</span><br/>               <span style="color: #A0A0A0">  67</span> <span style="color: #228B22; background: #FFFFFF;">%   - 2: Quadratic Initialization using previous function value and new</span><br/>               <span style="color: #A0A0A0">  68</span> <span style="color: #228B22; background: #FFFFFF;">%   function value/gradient (use this if steps tend to be very long)</span><br/>               <span style="color: #A0A0A0">  69</span> <span style="color: #228B22; background: #FFFFFF;">%       (t = min(1,2*(f-f_old)/g))</span><br/>               <span style="color: #A0A0A0">  70</span> <span style="color: #228B22; background: #FFFFFF;">%   - 3: The minimum between 1 and twice the previous step length</span><br/>               <span style="color: #A0A0A0">  71</span> <span style="color: #228B22; background: #FFFFFF;">%       (t = min(1,2*t)</span><br/>               <span style="color: #A0A0A0">  72</span> <span style="color: #228B22; background: #FFFFFF;">%   - 4: The scaled conjugate gradient step length (may accelerate</span><br/>               <span style="color: #A0A0A0">  73</span> <span style="color: #228B22; background: #FFFFFF;">%   conjugate gradient methods, but requires a Hessian-vector product)</span><br/>               <span style="color: #A0A0A0">  74</span> <span style="color: #228B22; background: #FFFFFF;">%       (t = g'd/d'Hd)</span><br/>               <span style="color: #A0A0A0">  75</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  76</span> <span style="color: #228B22; background: #FFFFFF;">% Inputs:</span><br/>               <span style="color: #A0A0A0">  77</span> <span style="color: #228B22; background: #FFFFFF;">%   funObj is a function handle</span><br/>               <span style="color: #A0A0A0">  78</span> <span style="color: #228B22; background: #FFFFFF;">%   x0 is a starting vector;</span><br/>               <span style="color: #A0A0A0">  79</span> <span style="color: #228B22; background: #FFFFFF;">%   options is a struct containing parameters</span><br/>               <span style="color: #A0A0A0">  80</span> <span style="color: #228B22; background: #FFFFFF;">%  (defaults are used for non-existent or blank fields)</span><br/>               <span style="color: #A0A0A0">  81</span> <span style="color: #228B22; background: #FFFFFF;">%   all other arguments are passed to funObj</span><br/>               <span style="color: #A0A0A0">  82</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  83</span> <span style="color: #228B22; background: #FFFFFF;">% Outputs:</span><br/>               <span style="color: #A0A0A0">  84</span> <span style="color: #228B22; background: #FFFFFF;">%   x is the minimum value found</span><br/>               <span style="color: #A0A0A0">  85</span> <span style="color: #228B22; background: #FFFFFF;">%   f is the function value at the minimum found</span><br/>               <span style="color: #A0A0A0">  86</span> <span style="color: #228B22; background: #FFFFFF;">%   exitflag returns an exit condition</span><br/>               <span style="color: #A0A0A0">  87</span> <span style="color: #228B22; background: #FFFFFF;">%   output returns a structure with other information</span><br/>               <span style="color: #A0A0A0">  88</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  89</span> <span style="color: #228B22; background: #FFFFFF;">% Supported Input Options</span><br/>               <span style="color: #A0A0A0">  90</span> <span style="color: #228B22; background: #FFFFFF;">%   Display - Level of display [ off | final | (iter) | full | excessive ]</span><br/>               <span style="color: #A0A0A0">  91</span> <span style="color: #228B22; background: #FFFFFF;">%   MaxFunEvals - Maximum number of function evaluations allowed (1000)</span><br/>               <span style="color: #A0A0A0">  92</span> <span style="color: #228B22; background: #FFFFFF;">%   MaxIter - Maximum number of iterations allowed (500)</span><br/>               <span style="color: #A0A0A0">  93</span> <span style="color: #228B22; background: #FFFFFF;">%   TolFun - Termination tolerance on the first-order optimality (1e-5)</span><br/>               <span style="color: #A0A0A0">  94</span> <span style="color: #228B22; background: #FFFFFF;">%   TolX - Termination tolerance on progress in terms of function/parameter changes (1e-9)</span><br/>               <span style="color: #A0A0A0">  95</span> <span style="color: #228B22; background: #FFFFFF;">%   Method - [ sd | csd | bb | cg | scg | pcg | {lbfgs} | newton0 | pnewton0 |</span><br/>               <span style="color: #A0A0A0">  96</span> <span style="color: #228B22; background: #FFFFFF;">%       qnewton | mnewton | newton | tensor ]</span><br/>               <span style="color: #A0A0A0">  97</span> <span style="color: #228B22; background: #FFFFFF;">%   c1 - Sufficient Decrease for Armijo condition (1e-4)</span><br/>               <span style="color: #A0A0A0">  98</span> <span style="color: #228B22; background: #FFFFFF;">%   c2 - Curvature Decrease for Wolfe conditions (.2 for cg methods, .9 otherwise)</span><br/>               <span style="color: #A0A0A0">  99</span> <span style="color: #228B22; background: #FFFFFF;">%   LS_init - Line Search Initialization -see above (2 for cg/sd, 4 for scg, 0 otherwise)</span><br/>               <span style="color: #A0A0A0"> 100</span> <span style="color: #228B22; background: #FFFFFF;">%   LS - Line Search type -see above (2 for bb, 4 otherwise)</span><br/>               <span style="color: #A0A0A0"> 101</span> <span style="color: #228B22; background: #FFFFFF;">%   Fref - Setting this to a positive integer greater than 1</span><br/>               <span style="color: #A0A0A0"> 102</span> <span style="color: #228B22; background: #FFFFFF;">%       will use non-monotone Armijo objective in the line search.</span><br/>               <span style="color: #A0A0A0"> 103</span> <span style="color: #228B22; background: #FFFFFF;">%       (20 for bb, 10 for csd, 1 for all others)</span><br/>               <span style="color: #A0A0A0"> 104</span> <span style="color: #228B22; background: #FFFFFF;">%   numDiff - compute derivative numerically</span><br/>               <span style="color: #A0A0A0"> 105</span> <span style="color: #228B22; background: #FFFFFF;">%       (default: 0) (this option has a different effect for 'newton', see below)</span><br/>               <span style="color: #A0A0A0"> 106</span> <span style="color: #228B22; background: #FFFFFF;">%   useComplex - if 1, use complex differentials when computing numerical derivatives</span><br/>               <span style="color: #A0A0A0"> 107</span> <span style="color: #228B22; background: #FFFFFF;">%       to get very accurate values (default: 0)</span><br/>               <span style="color: #A0A0A0"> 108</span> <span style="color: #228B22; background: #FFFFFF;">%   DerivativeCheck - if 'on', computes derivatives numerically at initial</span><br/>               <span style="color: #A0A0A0"> 109</span> <span style="color: #228B22; background: #FFFFFF;">%       point and compares to user-supplied derivative (default: 'off')</span><br/>               <span style="color: #A0A0A0"> 110</span> <span style="color: #228B22; background: #FFFFFF;">%   outputFcn - function to run after each iteration (default: []).  It</span><br/>               <span style="color: #A0A0A0"> 111</span> <span style="color: #228B22; background: #FFFFFF;">%       should have the following interface:</span><br/>               <span style="color: #A0A0A0"> 112</span> <span style="color: #228B22; background: #FFFFFF;">%       outputFcn(x,infoStruct,state,varargin{:})</span><br/>               <span style="color: #A0A0A0"> 113</span> <span style="color: #228B22; background: #FFFFFF;">%   useMex - where applicable, use mex files to speed things up (default: 1)</span><br/>               <span style="color: #A0A0A0"> 114</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 115</span> <span style="color: #228B22; background: #FFFFFF;">% Method-specific input options:</span><br/>               <span style="color: #A0A0A0"> 116</span> <span style="color: #228B22; background: #FFFFFF;">%   newton:</span><br/>               <span style="color: #A0A0A0"> 117</span> <span style="color: #228B22; background: #FFFFFF;">%       HessianModify - type of Hessian modification for direct solvers to</span><br/>               <span style="color: #A0A0A0"> 118</span> <span style="color: #228B22; background: #FFFFFF;">%       use if the Hessian is not positive definite (default: 0)</span><br/>               <span style="color: #A0A0A0"> 119</span> <span style="color: #228B22; background: #FFFFFF;">%           0: Minimum Euclidean norm s.t. eigenvalues sufficiently large</span><br/>               <span style="color: #A0A0A0"> 120</span> <span style="color: #228B22; background: #FFFFFF;">%           (requires eigenvalues on iterations where matrix is not pd)</span><br/>               <span style="color: #A0A0A0"> 121</span> <span style="color: #228B22; background: #FFFFFF;">%           1: Start with (1/2)*||A||_F and increment until Cholesky succeeds</span><br/>               <span style="color: #A0A0A0"> 122</span> <span style="color: #228B22; background: #FFFFFF;">%           (an approximation to method 0, does not require eigenvalues)</span><br/>               <span style="color: #A0A0A0"> 123</span> <span style="color: #228B22; background: #FFFFFF;">%           2: Modified LDL factorization</span><br/>               <span style="color: #A0A0A0"> 124</span> <span style="color: #228B22; background: #FFFFFF;">%           (only 1 generalized Cholesky factorization done and no eigenvalues required)</span><br/>               <span style="color: #A0A0A0"> 125</span> <span style="color: #228B22; background: #FFFFFF;">%           3: Modified Spectral Decomposition</span><br/>               <span style="color: #A0A0A0"> 126</span> <span style="color: #228B22; background: #FFFFFF;">%           (requires eigenvalues)</span><br/>               <span style="color: #A0A0A0"> 127</span> <span style="color: #228B22; background: #FFFFFF;">%           4: Modified Symmetric Indefinite Factorization</span><br/>               <span style="color: #A0A0A0"> 128</span> <span style="color: #228B22; background: #FFFFFF;">%           5: Uses the eigenvector of the smallest eigenvalue as negative</span><br/>               <span style="color: #A0A0A0"> 129</span> <span style="color: #228B22; background: #FFFFFF;">%           curvature direction</span><br/>               <span style="color: #A0A0A0"> 130</span> <span style="color: #228B22; background: #FFFFFF;">%       cgSolve - use conjugate gradient instead of direct solver (default: 0)</span><br/>               <span style="color: #A0A0A0"> 131</span> <span style="color: #228B22; background: #FFFFFF;">%           0: Direct Solver</span><br/>               <span style="color: #A0A0A0"> 132</span> <span style="color: #228B22; background: #FFFFFF;">%           1: Conjugate Gradient</span><br/>               <span style="color: #A0A0A0"> 133</span> <span style="color: #228B22; background: #FFFFFF;">%           2: Conjugate Gradient with Diagonal Preconditioner</span><br/>               <span style="color: #A0A0A0"> 134</span> <span style="color: #228B22; background: #FFFFFF;">%           3: Conjugate Gradient with LBFGS Preconditioner</span><br/>               <span style="color: #A0A0A0"> 135</span> <span style="color: #228B22; background: #FFFFFF;">%           x: Conjugate Graident with Symmetric Successive Over Relaxation</span><br/>               <span style="color: #A0A0A0"> 136</span> <span style="color: #228B22; background: #FFFFFF;">%           Preconditioner with parameter x</span><br/>               <span style="color: #A0A0A0"> 137</span> <span style="color: #228B22; background: #FFFFFF;">%               (where x is a real number in the range [0,2])</span><br/>               <span style="color: #A0A0A0"> 138</span> <span style="color: #228B22; background: #FFFFFF;">%           x: Conjugate Gradient with Incomplete Cholesky Preconditioner</span><br/>               <span style="color: #A0A0A0"> 139</span> <span style="color: #228B22; background: #FFFFFF;">%           with drop tolerance -x</span><br/>               <span style="color: #A0A0A0"> 140</span> <span style="color: #228B22; background: #FFFFFF;">%               (where x is a real negative number)</span><br/>               <span style="color: #A0A0A0"> 141</span> <span style="color: #228B22; background: #FFFFFF;">%       numDiff - compute Hessian numerically</span><br/>               <span style="color: #A0A0A0"> 142</span> <span style="color: #228B22; background: #FFFFFF;">%                 (default: 0, done with complex differentials if useComplex = 1)</span><br/>               <span style="color: #A0A0A0"> 143</span> <span style="color: #228B22; background: #FFFFFF;">%       LS_saveHessiancomp - when on, only computes the Hessian at the</span><br/>               <span style="color: #A0A0A0"> 144</span> <span style="color: #228B22; background: #FFFFFF;">%       first and last iteration of the line search (default: 1)</span><br/>               <span style="color: #A0A0A0"> 145</span> <span style="color: #228B22; background: #FFFFFF;">%   mnewton:</span><br/>               <span style="color: #A0A0A0"> 146</span> <span style="color: #228B22; background: #FFFFFF;">%       HessianIter - number of iterations to use same Hessian (default: 5)</span><br/>               <span style="color: #A0A0A0"> 147</span> <span style="color: #228B22; background: #FFFFFF;">%   qnewton:</span><br/>               <span style="color: #A0A0A0"> 148</span> <span style="color: #228B22; background: #FFFFFF;">%       initialHessType - scale initial Hessian approximation (default: 1)</span><br/>               <span style="color: #A0A0A0"> 149</span> <span style="color: #228B22; background: #FFFFFF;">%       qnUpdate - type of quasi-Newton update (default: 3):</span><br/>               <span style="color: #A0A0A0"> 150</span> <span style="color: #228B22; background: #FFFFFF;">%           0: BFGS</span><br/>               <span style="color: #A0A0A0"> 151</span> <span style="color: #228B22; background: #FFFFFF;">%           1: SR1 (when it is positive-definite, otherwise BFGS)</span><br/>               <span style="color: #A0A0A0"> 152</span> <span style="color: #228B22; background: #FFFFFF;">%           2: Hoshino</span><br/>               <span style="color: #A0A0A0"> 153</span> <span style="color: #228B22; background: #FFFFFF;">%           3: Self-Scaling BFGS</span><br/>               <span style="color: #A0A0A0"> 154</span> <span style="color: #228B22; background: #FFFFFF;">%           4: Oren's Self-Scaling Variable Metric method </span><br/>               <span style="color: #A0A0A0"> 155</span> <span style="color: #228B22; background: #FFFFFF;">%           5: McCormick-Huang asymmetric update</span><br/>               <span style="color: #A0A0A0"> 156</span> <span style="color: #228B22; background: #FFFFFF;">%       Damped - use damped BFGS update (default: 1)</span><br/>               <span style="color: #A0A0A0"> 157</span> <span style="color: #228B22; background: #FFFFFF;">%   newton0/pnewton0:</span><br/>               <span style="color: #A0A0A0"> 158</span> <span style="color: #228B22; background: #FFFFFF;">%       HvFunc - user-supplied function that returns Hessian-vector products</span><br/>               <span style="color: #A0A0A0"> 159</span> <span style="color: #228B22; background: #FFFFFF;">%           (by default, these are computed numerically using autoHv)</span><br/>               <span style="color: #A0A0A0"> 160</span> <span style="color: #228B22; background: #FFFFFF;">%           HvFunc should have the following interface: HvFunc(v,x,varargin{:})</span><br/>               <span style="color: #A0A0A0"> 161</span> <span style="color: #228B22; background: #FFFFFF;">%       useComplex - use a complex perturbation to get high accuracy</span><br/>               <span style="color: #A0A0A0"> 162</span> <span style="color: #228B22; background: #FFFFFF;">%           Hessian-vector products (default: 0)</span><br/>               <span style="color: #A0A0A0"> 163</span> <span style="color: #228B22; background: #FFFFFF;">%           (the increased accuracy can make the method much more efficient,</span><br/>               <span style="color: #A0A0A0"> 164</span> <span style="color: #228B22; background: #FFFFFF;">%               but gradient code must properly support complex inputs)</span><br/>               <span style="color: #A0A0A0"> 165</span> <span style="color: #228B22; background: #FFFFFF;">%       useNegCurv - a negative curvature direction is used as the descent</span><br/>               <span style="color: #A0A0A0"> 166</span> <span style="color: #228B22; background: #FFFFFF;">%           direction if one is encountered during the cg iterations</span><br/>               <span style="color: #A0A0A0"> 167</span> <span style="color: #228B22; background: #FFFFFF;">%           (default: 1)</span><br/>               <span style="color: #A0A0A0"> 168</span> <span style="color: #228B22; background: #FFFFFF;">%       precFunc (for pnewton0 only) - user-supplied preconditioner</span><br/>               <span style="color: #A0A0A0"> 169</span> <span style="color: #228B22; background: #FFFFFF;">%           (by default, an L-BFGS preconditioner is used)</span><br/>               <span style="color: #A0A0A0"> 170</span> <span style="color: #228B22; background: #FFFFFF;">%           precFunc should have the following interfact:</span><br/>               <span style="color: #A0A0A0"> 171</span> <span style="color: #228B22; background: #FFFFFF;">%           precFunc(v,x,varargin{:})</span><br/>               <span style="color: #A0A0A0"> 172</span> <span style="color: #228B22; background: #FFFFFF;">%   lbfgs:</span><br/>               <span style="color: #A0A0A0"> 173</span> <span style="color: #228B22; background: #FFFFFF;">%       Corr - number of corrections to store in memory (default: 100)</span><br/>               <span style="color: #A0A0A0"> 174</span> <span style="color: #228B22; background: #FFFFFF;">%           (higher numbers converge faster but use more memory)</span><br/>               <span style="color: #A0A0A0"> 175</span> <span style="color: #228B22; background: #FFFFFF;">%       Damped - use damped update (default: 0)</span><br/>               <span style="color: #A0A0A0"> 176</span> <span style="color: #228B22; background: #FFFFFF;">%   pcg:</span><br/>               <span style="color: #A0A0A0"> 177</span> <span style="color: #228B22; background: #FFFFFF;">%       cgUpdate - type of update (default: 2)</span><br/>               <span style="color: #A0A0A0"> 178</span> <span style="color: #228B22; background: #FFFFFF;">%   cg/scg/pcg:</span><br/>               <span style="color: #A0A0A0"> 179</span> <span style="color: #228B22; background: #FFFFFF;">%       cgUpdate - type of update (default for cg/scg: 2, default for pcg: 1)</span><br/>               <span style="color: #A0A0A0"> 180</span> <span style="color: #228B22; background: #FFFFFF;">%           0: Fletcher Reeves</span><br/>               <span style="color: #A0A0A0"> 181</span> <span style="color: #228B22; background: #FFFFFF;">%           1: Polak-Ribiere</span><br/>               <span style="color: #A0A0A0"> 182</span> <span style="color: #228B22; background: #FFFFFF;">%           2: Hestenes-Stiefel (not supported for pcg)</span><br/>               <span style="color: #A0A0A0"> 183</span> <span style="color: #228B22; background: #FFFFFF;">%           3: Gilbert-Nocedal</span><br/>               <span style="color: #A0A0A0"> 184</span> <span style="color: #228B22; background: #FFFFFF;">%       HvFunc (for scg only)- user-supplied function that returns Hessian-vector </span><br/>               <span style="color: #A0A0A0"> 185</span> <span style="color: #228B22; background: #FFFFFF;">%           products</span><br/>               <span style="color: #A0A0A0"> 186</span> <span style="color: #228B22; background: #FFFFFF;">%           (by default, these are computed numerically using autoHv)</span><br/>               <span style="color: #A0A0A0"> 187</span> <span style="color: #228B22; background: #FFFFFF;">%           HvFunc should have the following interface:</span><br/>               <span style="color: #A0A0A0"> 188</span> <span style="color: #228B22; background: #FFFFFF;">%           HvFunc(v,x,varargin{:})</span><br/>               <span style="color: #A0A0A0"> 189</span> <span style="color: #228B22; background: #FFFFFF;">%       precFunc (for pcg only) - user-supplied preconditioner</span><br/>               <span style="color: #A0A0A0"> 190</span> <span style="color: #228B22; background: #FFFFFF;">%           (by default, an L-BFGS preconditioner is used)</span><br/>               <span style="color: #A0A0A0"> 191</span> <span style="color: #228B22; background: #FFFFFF;">%           precFunc should have the following interfact:</span><br/>               <span style="color: #A0A0A0"> 192</span> <span style="color: #228B22; background: #FFFFFF;">%           precFunc(v,x,varargin{:})</span><br/>               <span style="color: #A0A0A0"> 193</span> <span style="color: #228B22; background: #FFFFFF;">%   bb:</span><br/>               <span style="color: #A0A0A0"> 194</span> <span style="color: #228B22; background: #FFFFFF;">%       bbType - type of bb step (default: 1)</span><br/>               <span style="color: #A0A0A0"> 195</span> <span style="color: #228B22; background: #FFFFFF;">%           0: min_alpha ||delta_x - alpha delta_g||_2</span><br/>               <span style="color: #A0A0A0"> 196</span> <span style="color: #228B22; background: #FFFFFF;">%           1: min_alpha ||alpha delta_x - delta_g||_2</span><br/>               <span style="color: #A0A0A0"> 197</span> <span style="color: #228B22; background: #FFFFFF;">%           2: Conic BB</span><br/>               <span style="color: #A0A0A0"> 198</span> <span style="color: #228B22; background: #FFFFFF;">%           3: Gradient method with retards</span><br/>               <span style="color: #A0A0A0"> 199</span> <span style="color: #228B22; background: #FFFFFF;">%   csd:</span><br/>               <span style="color: #A0A0A0"> 200</span> <span style="color: #228B22; background: #FFFFFF;">%       cycle - length of cycle (default: 3)</span><br/>               <span style="color: #A0A0A0"> 201</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 202</span> <span style="color: #228B22; background: #FFFFFF;">% Supported Output Options</span><br/>               <span style="color: #A0A0A0"> 203</span> <span style="color: #228B22; background: #FFFFFF;">%   iterations - number of iterations taken</span><br/>               <span style="color: #A0A0A0"> 204</span> <span style="color: #228B22; background: #FFFFFF;">%   funcCount - number of function evaluations</span><br/>               <span style="color: #A0A0A0"> 205</span> <span style="color: #228B22; background: #FFFFFF;">%   algorithm - algorithm used</span><br/>               <span style="color: #A0A0A0"> 206</span> <span style="color: #228B22; background: #FFFFFF;">%   firstorderopt - first-order optimality</span><br/>               <span style="color: #A0A0A0"> 207</span> <span style="color: #228B22; background: #FFFFFF;">%   message - exit message</span><br/>               <span style="color: #A0A0A0"> 208</span> <span style="color: #228B22; background: #FFFFFF;">%   trace.funccount - function evaluations after each iteration</span><br/>               <span style="color: #A0A0A0"> 209</span> <span style="color: #228B22; background: #FFFFFF;">%   trace.fval - function value after each iteration</span><br/>               <span style="color: #A0A0A0"> 210</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 211</span> <span style="color: #228B22; background: #FFFFFF;">% Author: Mark Schmidt (2006)</span><br/>               <span style="color: #A0A0A0"> 212</span> <span style="color: #228B22; background: #FFFFFF;">% Web: http://www.cs.ubc.ca/~schmidtm</span><br/>               <span style="color: #A0A0A0"> 213</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 214</span> <span style="color: #228B22; background: #FFFFFF;">% Sources (in order of how much the source material contributes):</span><br/>               <span style="color: #A0A0A0"> 215</span> <span style="color: #228B22; background: #FFFFFF;">%   J. Nocedal and S.J. Wright.  1999.  "Numerical Optimization".  Springer Verlag.</span><br/>               <span style="color: #A0A0A0"> 216</span> <span style="color: #228B22; background: #FFFFFF;">%   R. Fletcher.  1987.  "Practical Methods of Optimization".  Wiley.</span><br/>               <span style="color: #A0A0A0"> 217</span> <span style="color: #228B22; background: #FFFFFF;">%   J. Demmel.  1997.  "Applied Linear Algebra.  SIAM.</span><br/>               <span style="color: #A0A0A0"> 218</span> <span style="color: #228B22; background: #FFFFFF;">%   R. Barret, M. Berry, T. Chan, J. Demmel, J. Dongarra, V. Eijkhout, R.</span><br/>               <span style="color: #A0A0A0"> 219</span> <span style="color: #228B22; background: #FFFFFF;">%   Pozo, C. Romine, and H. Van der Vost.  1994.  "Templates for the Solution of</span><br/>               <span style="color: #A0A0A0"> 220</span> <span style="color: #228B22; background: #FFFFFF;">%   Linear Systems: Building Blocks for Iterative Methods".  SIAM.</span><br/>               <span style="color: #A0A0A0"> 221</span> <span style="color: #228B22; background: #FFFFFF;">%   J. More and D. Thuente.  "Line search algorithms with guaranteed</span><br/>               <span style="color: #A0A0A0"> 222</span> <span style="color: #228B22; background: #FFFFFF;">%   sufficient decrease".  ACM Trans. Math. Softw. vol 20, 286-307, 1994.</span><br/>               <span style="color: #A0A0A0"> 223</span> <span style="color: #228B22; background: #FFFFFF;">%   M. Raydan.  "The Barzilai and Borwein gradient method for the large</span><br/>               <span style="color: #A0A0A0"> 224</span> <span style="color: #228B22; background: #FFFFFF;">%   scale unconstrained minimization problem".  SIAM J. Optim., 7, 26-33,</span><br/>               <span style="color: #A0A0A0"> 225</span> <span style="color: #228B22; background: #FFFFFF;">%   (1997).</span><br/>               <span style="color: #A0A0A0"> 226</span> <span style="color: #228B22; background: #FFFFFF;">%   "Mathematical Optimization".  The Computational Science Education</span><br/>               <span style="color: #A0A0A0"> 227</span> <span style="color: #228B22; background: #FFFFFF;">%   Project.  1995.</span><br/>               <span style="color: #A0A0A0"> 228</span> <span style="color: #228B22; background: #FFFFFF;">%   C. Kelley.  1999.  "Iterative Methods for Optimization".  Frontiers in</span><br/>               <span style="color: #A0A0A0"> 229</span> <span style="color: #228B22; background: #FFFFFF;">%   Applied Mathematics.  SIAM.</span><br/>               <span style="color: #A0A0A0"> 230</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 231</span> <span style="color: #000000; background: #FFFFFF;">if nargin &lt; 3 </span><br/>               <span style="color: #A0A0A0"> 232</span> <span style="color: #A0A0A0; background: #FFFFFF;">    options = [];</span><br/>               <span style="color: #A0A0A0"> 233</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0"> 234</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 235</span> <span style="color: #228B22; background: #FFFFFF;">% Get Parameters</span><br/><span style="color: #FF0000">  0.09 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 236</span> <span style="color: #000000; background: #FFFFFF;">[verbose,verboseI,debug,doPlot,maxFunEvals,maxIter,tolFun,tolX,method,... </span><br/>               <span style="color: #A0A0A0"> 237</span> <span style="color: #000000; background: #FFFFFF;">    corrections,c1,c2,LS_init,LS,cgSolve,qnUpdate,cgUpdate,initialHessType,...</span><br/>               <span style="color: #A0A0A0"> 238</span> <span style="color: #000000; background: #FFFFFF;">    HessianModify,Fref,useComplex,numDiff,LS_saveHessianComp,...</span><br/>               <span style="color: #A0A0A0"> 239</span> <span style="color: #000000; background: #FFFFFF;">    DerivativeCheck,Damped,HvFunc,bbType,cycle,...</span><br/>               <span style="color: #A0A0A0"> 240</span> <span style="color: #000000; background: #FFFFFF;">    HessianIter,outputFcn,useMex,useNegCurv,precFunc] = ...</span><br/>               <span style="color: #A0A0A0"> 241</span> <span style="color: #000000; background: #FFFFFF;">    minFunc_processInputOptions(options);</span><br/>               <span style="color: #A0A0A0"> 242</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 243</span> <span style="color: #000000; background: #FFFFFF;">if isfield(options, 'logfile') </span><br/>               <span style="color: #A0A0A0"> 244</span> <span style="color: #A0A0A0; background: #FFFFFF;">    logfile = options.logfile;</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 245</span> <span style="color: #228B22; background: #FFFFFF;">else </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 246</span> <span style="color: #000000; background: #FFFFFF;">    logfile = []; </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 247</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0"> 248</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 249</span> <span style="color: #228B22; background: #FFFFFF;">% Constants</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 250</span> <span style="color: #000000; background: #FFFFFF;">SD = 0; </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 251</span> <span style="color: #000000; background: #FFFFFF;">CSD = 1; </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 252</span> <span style="color: #000000; background: #FFFFFF;">BB = 2; </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 253</span> <span style="color: #000000; background: #FFFFFF;">CG = 3; </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 254</span> <span style="color: #000000; background: #FFFFFF;">PCG = 4; </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 255</span> <span style="color: #000000; background: #FFFFFF;">LBFGS = 5; </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 256</span> <span style="color: #000000; background: #FFFFFF;">QNEWTON = 6; </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 257</span> <span style="color: #000000; background: #FFFFFF;">NEWTON0 = 7; </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 258</span> <span style="color: #000000; background: #FFFFFF;">NEWTON = 8; </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 259</span> <span style="color: #000000; background: #FFFFFF;">TENSOR = 9; </span><br/>               <span style="color: #A0A0A0"> 260</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 261</span> <span style="color: #228B22; background: #FFFFFF;">% Initialize</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 262</span> <span style="color: #000000; background: #FFFFFF;">p = length(x0); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 263</span> <span style="color: #000000; background: #FFFFFF;">d = zeros(p,1); </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 264</span> <span style="color: #000000; background: #FFFFFF;">x = x0; </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 265</span> <span style="color: #000000; background: #FFFFFF;">t = 1; </span><br/>               <span style="color: #A0A0A0"> 266</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 267</span> <span style="color: #228B22; background: #FFFFFF;">% If necessary, form numerical differentiation functions</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 268</span> <span style="color: #000000; background: #FFFFFF;">funEvalMultiplier = 1; </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 269</span> <span style="color: #000000; background: #FFFFFF;">if numDiff &amp;&amp; method ~= TENSOR </span><br/>               <span style="color: #A0A0A0"> 270</span> <span style="color: #A0A0A0; background: #FFFFFF;">    varargin(3:end+2) = varargin(1:end);</span><br/>               <span style="color: #A0A0A0"> 271</span> <span style="color: #A0A0A0; background: #FFFFFF;">    varargin{1} = useComplex;</span><br/>               <span style="color: #A0A0A0"> 272</span> <span style="color: #A0A0A0; background: #FFFFFF;">    varargin{2} = funObj;</span><br/>               <span style="color: #A0A0A0"> 273</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if method ~= NEWTON</span><br/>               <span style="color: #A0A0A0"> 274</span> <span style="color: #A0A0A0; background: #FFFFFF;">        if debug</span><br/>               <span style="color: #A0A0A0"> 275</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if useComplex</span><br/>               <span style="color: #A0A0A0"> 276</span> <span style="color: #A0A0A0; background: #FFFFFF;">                fprintf('Using complex differentials for gradient computation\n');</span><br/>               <span style="color: #A0A0A0"> 277</span> <span style="color: #228B22; background: #FFFFFF;">            else</span><br/>               <span style="color: #A0A0A0"> 278</span> <span style="color: #A0A0A0; background: #FFFFFF;">                fprintf('Using finite differences for gradient computation\n');</span><br/>               <span style="color: #A0A0A0"> 279</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 280</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0"> 281</span> <span style="color: #A0A0A0; background: #FFFFFF;">        funObj = @autoGrad;</span><br/>               <span style="color: #A0A0A0"> 282</span> <span style="color: #228B22; background: #FFFFFF;">    else</span><br/>               <span style="color: #A0A0A0"> 283</span> <span style="color: #A0A0A0; background: #FFFFFF;">        if debug</span><br/>               <span style="color: #A0A0A0"> 284</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if useComplex</span><br/>               <span style="color: #A0A0A0"> 285</span> <span style="color: #A0A0A0; background: #FFFFFF;">                fprintf('Using complex differentials for gradient computation\n');</span><br/>               <span style="color: #A0A0A0"> 286</span> <span style="color: #228B22; background: #FFFFFF;">            else</span><br/>               <span style="color: #A0A0A0"> 287</span> <span style="color: #A0A0A0; background: #FFFFFF;">                fprintf('Using finite differences for gradient computation\n');</span><br/>               <span style="color: #A0A0A0"> 288</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 289</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0"> 290</span> <span style="color: #A0A0A0; background: #FFFFFF;">        funObj = @autoHess;</span><br/>               <span style="color: #A0A0A0"> 291</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 292</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 293</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if method == NEWTON0 &amp;&amp; useComplex == 1</span><br/>               <span style="color: #A0A0A0"> 294</span> <span style="color: #A0A0A0; background: #FFFFFF;">        if debug</span><br/>               <span style="color: #A0A0A0"> 295</span> <span style="color: #A0A0A0; background: #FFFFFF;">            fprintf('Turning off the use of complex differentials\n');</span><br/>               <span style="color: #A0A0A0"> 296</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0"> 297</span> <span style="color: #A0A0A0; background: #FFFFFF;">        useComplex = 0;</span><br/>               <span style="color: #A0A0A0"> 298</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 299</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 300</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if useComplex</span><br/>               <span style="color: #A0A0A0"> 301</span> <span style="color: #A0A0A0; background: #FFFFFF;">        funEvalMultiplier = p;</span><br/>               <span style="color: #A0A0A0"> 302</span> <span style="color: #228B22; background: #FFFFFF;">    else</span><br/>               <span style="color: #A0A0A0"> 303</span> <span style="color: #A0A0A0; background: #FFFFFF;">        funEvalMultiplier = p+1;</span><br/>               <span style="color: #A0A0A0"> 304</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 305</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0"> 306</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 307</span> <span style="color: #228B22; background: #FFFFFF;">% Evaluate Initial Point</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 308</span> <span style="color: #000000; background: #FFFFFF;">if method &lt; NEWTON </span><br/><span style="color: #FF0000">  4.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 309</span> <a name="Line309"></a><span style="color: #000000; background: #FFFFFF;">    [f,g] = feval(funObj, x, varargin{:}); </span><br/>               <span style="color: #A0A0A0"> 310</span> <span style="color: #228B22; background: #FFFFFF;">else</span><br/>               <span style="color: #A0A0A0"> 311</span> <span style="color: #A0A0A0; background: #FFFFFF;">    [f,g,H] = feval(funObj, x, varargin{:});</span><br/><a name="Line312"></a>               <span style="color: #A0A0A0"> 312</span> <span style="color: #A0A0A0; background: #FFFFFF;">    computeHessian = 1;</span><br/>               <span style="color: #A0A0A0"> 313</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 314</span> <span style="color: #000000; background: #FFFFFF;">funEvals = 1; </span><br/>               <span style="color: #A0A0A0"> 315</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 316</span> <span style="color: #000000; background: #FFFFFF;">if strcmp(DerivativeCheck,'on') </span><br/>               <span style="color: #A0A0A0"> 317</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if numDiff</span><br/>               <span style="color: #A0A0A0"> 318</span> <span style="color: #A0A0A0; background: #FFFFFF;">        fprintf('Can not do derivative checking when numDiff is 1\n');</span><br/>               <span style="color: #A0A0A0"> 319</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 320</span> <span style="color: #228B22; background: #FFFFFF;">    % Check provided gradient/hessian function using numerical derivatives</span><br/>               <span style="color: #A0A0A0"> 321</span> <span style="color: #A0A0A0; background: #FFFFFF;">    fprintf('Checking Gradient:\n');</span><br/><a name="Line322"></a>               <span style="color: #A0A0A0"> 322</span> <span style="color: #A0A0A0; background: #FFFFFF;">    [f2,g2] = autoGrad(x,useComplex,funObj,varargin{:});</span><br/>               <span style="color: #A0A0A0"> 323</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 324</span> <span style="color: #A0A0A0; background: #FFFFFF;">    fprintf('Max difference between user and numerical gradient: %f\n',max(abs(g-g2)));</span><br/>               <span style="color: #A0A0A0"> 325</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if max(abs(g-g2)) &gt; 1e-4</span><br/>               <span style="color: #A0A0A0"> 326</span> <span style="color: #A0A0A0; background: #FFFFFF;">        fprintf('User NumDif:\n');</span><br/><a name="Line327"></a>               <span style="color: #A0A0A0"> 327</span> <span style="color: #A0A0A0; background: #FFFFFF;">        [g g2]</span><br/><a name="Line328"></a>               <span style="color: #A0A0A0"> 328</span> <span style="color: #A0A0A0; background: #FFFFFF;">        diff = abs(g-g2)</span><br/>               <span style="color: #A0A0A0"> 329</span> <span style="color: #A0A0A0; background: #FFFFFF;">        pause;</span><br/>               <span style="color: #A0A0A0"> 330</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 331</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 332</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if method &gt;= NEWTON</span><br/>               <span style="color: #A0A0A0"> 333</span> <span style="color: #A0A0A0; background: #FFFFFF;">        fprintf('Check Hessian:\n');</span><br/><a name="Line334"></a>               <span style="color: #A0A0A0"> 334</span> <span style="color: #A0A0A0; background: #FFFFFF;">        [f2,g2,H2] = autoHess(x,useComplex,funObj,varargin{:});</span><br/>               <span style="color: #A0A0A0"> 335</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 336</span> <span style="color: #A0A0A0; background: #FFFFFF;">        fprintf('Max difference between user and numerical hessian: %f\n',max(abs(H(:)-H2(:))));</span><br/>               <span style="color: #A0A0A0"> 337</span> <span style="color: #A0A0A0; background: #FFFFFF;">        if max(abs(H(:)-H2(:))) &gt; 1e-4</span><br/><a name="Line338"></a>               <span style="color: #A0A0A0"> 338</span> <span style="color: #A0A0A0; background: #FFFFFF;">            H</span><br/><a name="Line339"></a>               <span style="color: #A0A0A0"> 339</span> <span style="color: #A0A0A0; background: #FFFFFF;">            H2</span><br/><a name="Line340"></a>               <span style="color: #A0A0A0"> 340</span> <span style="color: #A0A0A0; background: #FFFFFF;">            diff = abs(H-H2)</span><br/>               <span style="color: #A0A0A0"> 341</span> <span style="color: #A0A0A0; background: #FFFFFF;">            pause;</span><br/>               <span style="color: #A0A0A0"> 342</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0"> 343</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 344</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0"> 345</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 346</span> <span style="color: #228B22; background: #FFFFFF;">% Output Log</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 347</span> <span style="color: #000000; background: #FFFFFF;">if verboseI </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 348</span> <span style="color: #000000; background: #FFFFFF;">    fprintf('%10s %10s %15s %15s %15s\n','Iteration','FunEvals','Step Length','Function Val','Opt Cond'); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 349</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0"> 350</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 351</span> <span style="color: #000000; background: #FFFFFF;">if logfile </span><br/>               <span style="color: #A0A0A0"> 352</span> <span style="color: #A0A0A0; background: #FFFFFF;">    fid = fopen(logfile, 'a');</span><br/>               <span style="color: #A0A0A0"> 353</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if (fid &gt; 0)</span><br/>               <span style="color: #A0A0A0"> 354</span> <span style="color: #A0A0A0; background: #FFFFFF;">        fprintf(fid, '-- %10s %10s %15s %15s %15s\n','Iteration','FunEvals','Step Length','Function Val','Opt Cond');</span><br/>               <span style="color: #A0A0A0"> 355</span> <span style="color: #A0A0A0; background: #FFFFFF;">        fclose(fid);</span><br/>               <span style="color: #A0A0A0"> 356</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 357</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0"> 358</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 359</span> <span style="color: #228B22; background: #FFFFFF;">% Output Function</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 360</span> <span style="color: #000000; background: #FFFFFF;">if ~isempty(outputFcn) </span><br/>               <span style="color: #A0A0A0"> 361</span> <span style="color: #A0A0A0; background: #FFFFFF;">    callOutput(outputFcn,x,'init',0,funEvals,f,[],[],g,[],sum(abs(g)),varargin{:});</span><br/>               <span style="color: #A0A0A0"> 362</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0"> 363</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 364</span> <span style="color: #228B22; background: #FFFFFF;">% Initialize Trace</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 365</span> <span style="color: #000000; background: #FFFFFF;">trace.fval = f; </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 366</span> <span style="color: #000000; background: #FFFFFF;">trace.funcCount = funEvals; </span><br/>               <span style="color: #A0A0A0"> 367</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 368</span> <span style="color: #228B22; background: #FFFFFF;">% Check optimality of initial point</span><br/><span style="color: #FF0000">  0.04 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 369</span> <span style="color: #000000; background: #FFFFFF;">if sum(abs(g)) &lt;= tolFun </span><br/>               <span style="color: #A0A0A0"> 370</span> <span style="color: #A0A0A0; background: #FFFFFF;">    exitflag=1;</span><br/>               <span style="color: #A0A0A0"> 371</span> <span style="color: #A0A0A0; background: #FFFFFF;">    msg = 'Optimality Condition below TolFun';</span><br/>               <span style="color: #A0A0A0"> 372</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if verbose</span><br/>               <span style="color: #A0A0A0"> 373</span> <span style="color: #A0A0A0; background: #FFFFFF;">        fprintf('%s\n',msg);</span><br/>               <span style="color: #A0A0A0"> 374</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 375</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if nargout &gt; 3</span><br/>               <span style="color: #A0A0A0"> 376</span> <span style="color: #A0A0A0; background: #FFFFFF;">        output = struct('iterations',0,'funcCount',1,...</span><br/>               <span style="color: #A0A0A0"> 377</span> <span style="color: #A0A0A0; background: #FFFFFF;">            'algorithm',method,'firstorderopt',sum(abs(g)),'message',msg,'trace',trace);</span><br/>               <span style="color: #A0A0A0"> 378</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 379</span> <span style="color: #A0A0A0; background: #FFFFFF;">    return;</span><br/>               <span style="color: #A0A0A0"> 380</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0"> 381</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 382</span> <span style="color: #228B22; background: #FFFFFF;">% Perform up to a maximum of 'maxIter' descent steps:</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 383</span> <span style="color: #000000; background: #FFFFFF;">for i = 1:maxIter </span><br/>               <span style="color: #A0A0A0"> 384</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 385</span> <span style="color: #228B22; background: #FFFFFF;">    % ****************** COMPUTE DESCENT DIRECTION *****************</span><br/>               <span style="color: #A0A0A0"> 386</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold"> 387</span> <span style="color: #000000; background: #FFFFFF;">    switch method </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold"> 388</span> <span style="color: #000000; background: #FFFFFF;">        case SD % Steepest Descent </span><br/>               <span style="color: #A0A0A0"> 389</span> <span style="color: #A0A0A0; background: #FFFFFF;">            d = -g;</span><br/>               <span style="color: #A0A0A0"> 390</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold"> 391</span> <span style="color: #000000; background: #FFFFFF;">        case CSD % Cyclic Steepest Descent </span><br/>               <span style="color: #A0A0A0"> 392</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 393</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if mod(i,cycle) == 1 % Use Steepest Descent</span><br/>               <span style="color: #A0A0A0"> 394</span> <span style="color: #A0A0A0; background: #FFFFFF;">                alpha = 1;</span><br/>               <span style="color: #A0A0A0"> 395</span> <span style="color: #A0A0A0; background: #FFFFFF;">                LS_init = 2;</span><br/>               <span style="color: #A0A0A0"> 396</span> <span style="color: #A0A0A0; background: #FFFFFF;">                LS = 4; % Precise Line Search</span><br/>               <span style="color: #A0A0A0"> 397</span> <span style="color: #A0A0A0; background: #FFFFFF;">            elseif mod(i,cycle) == mod(1+1,cycle) % Use Previous Step</span><br/>               <span style="color: #A0A0A0"> 398</span> <span style="color: #A0A0A0; background: #FFFFFF;">                alpha = t;</span><br/>               <span style="color: #A0A0A0"> 399</span> <span style="color: #A0A0A0; background: #FFFFFF;">                LS_init = 0;</span><br/>               <span style="color: #A0A0A0"> 400</span> <span style="color: #A0A0A0; background: #FFFFFF;">                LS = 2; % Non-monotonic line search</span><br/>               <span style="color: #A0A0A0"> 401</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 402</span> <span style="color: #A0A0A0; background: #FFFFFF;">            d = -alpha*g;</span><br/>               <span style="color: #A0A0A0"> 403</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold"> 404</span> <span style="color: #000000; background: #FFFFFF;">        case BB % Steepest Descent with Barzilai and Borwein Step Length </span><br/>               <span style="color: #A0A0A0"> 405</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 406</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if i == 1</span><br/>               <span style="color: #A0A0A0"> 407</span> <span style="color: #A0A0A0; background: #FFFFFF;">                d = -g;</span><br/>               <span style="color: #A0A0A0"> 408</span> <span style="color: #228B22; background: #FFFFFF;">            else</span><br/>               <span style="color: #A0A0A0"> 409</span> <span style="color: #A0A0A0; background: #FFFFFF;">                y = g-g_old;</span><br/>               <span style="color: #A0A0A0"> 410</span> <span style="color: #A0A0A0; background: #FFFFFF;">                s = t*d;</span><br/>               <span style="color: #A0A0A0"> 411</span> <span style="color: #A0A0A0; background: #FFFFFF;">                if bbType == 0</span><br/>               <span style="color: #A0A0A0"> 412</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    yy = y'*y;</span><br/>               <span style="color: #A0A0A0"> 413</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    alpha = (s'*y)/(yy);</span><br/>               <span style="color: #A0A0A0"> 414</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    if alpha &lt;= 1e-10 || alpha &gt; 1e10</span><br/>               <span style="color: #A0A0A0"> 415</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        alpha = 1;</span><br/>               <span style="color: #A0A0A0"> 416</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/>               <span style="color: #A0A0A0"> 417</span> <span style="color: #A0A0A0; background: #FFFFFF;">                elseif bbType == 1</span><br/>               <span style="color: #A0A0A0"> 418</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    sy = s'*y;</span><br/>               <span style="color: #A0A0A0"> 419</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    alpha = (s'*s)/sy;</span><br/>               <span style="color: #A0A0A0"> 420</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    if alpha &lt;= 1e-10 || alpha &gt; 1e10</span><br/>               <span style="color: #A0A0A0"> 421</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        alpha = 1;</span><br/>               <span style="color: #A0A0A0"> 422</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/>               <span style="color: #A0A0A0"> 423</span> <span style="color: #A0A0A0; background: #FFFFFF;">                elseif bbType == 2 % Conic Interpolation ('Modified BB')</span><br/>               <span style="color: #A0A0A0"> 424</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    sy = s'*y;</span><br/>               <span style="color: #A0A0A0"> 425</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    ss = s'*s;</span><br/>               <span style="color: #A0A0A0"> 426</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    alpha = ss/sy;</span><br/>               <span style="color: #A0A0A0"> 427</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    if alpha &lt;= 1e-10 || alpha &gt; 1e10</span><br/>               <span style="color: #A0A0A0"> 428</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        alpha = 1;</span><br/>               <span style="color: #A0A0A0"> 429</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/>               <span style="color: #A0A0A0"> 430</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    alphaConic = ss/(6*(myF_old - f) + 4*g'*s + 2*g_old'*s);</span><br/>               <span style="color: #A0A0A0"> 431</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    if alphaConic &gt; .001*alpha &amp;&amp; alphaConic &lt; 1000*alpha</span><br/>               <span style="color: #A0A0A0"> 432</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        alpha = alphaConic;</span><br/>               <span style="color: #A0A0A0"> 433</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/>               <span style="color: #A0A0A0"> 434</span> <span style="color: #A0A0A0; background: #FFFFFF;">                elseif bbType == 3 % Gradient Method with retards (bb type 1, random selection of previous step)</span><br/>               <span style="color: #A0A0A0"> 435</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    sy = s'*y;</span><br/>               <span style="color: #A0A0A0"> 436</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    alpha = (s'*s)/sy;</span><br/>               <span style="color: #A0A0A0"> 437</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    if alpha &lt;= 1e-10 || alpha &gt; 1e10</span><br/>               <span style="color: #A0A0A0"> 438</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        alpha = 1;</span><br/>               <span style="color: #A0A0A0"> 439</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/><a name="Line440"></a>               <span style="color: #A0A0A0"> 440</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    v(1+mod(i-2,5)) = alpha;</span><br/>               <span style="color: #A0A0A0"> 441</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    alpha = v(ceil(rand*length(v)));</span><br/>               <span style="color: #A0A0A0"> 442</span> <span style="color: #A0A0A0; background: #FFFFFF;">                end</span><br/>               <span style="color: #A0A0A0"> 443</span> <span style="color: #A0A0A0; background: #FFFFFF;">                d = -alpha*g;</span><br/>               <span style="color: #A0A0A0"> 444</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 445</span> <span style="color: #A0A0A0; background: #FFFFFF;">            g_old = g;</span><br/>               <span style="color: #A0A0A0"> 446</span> <span style="color: #A0A0A0; background: #FFFFFF;">            myF_old = f;</span><br/>               <span style="color: #A0A0A0"> 447</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 448</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold"> 449</span> <span style="color: #000000; background: #FFFFFF;">        case CG % Non-Linear Conjugate Gradient </span><br/>               <span style="color: #A0A0A0"> 450</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 451</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if i == 1</span><br/>               <span style="color: #A0A0A0"> 452</span> <span style="color: #A0A0A0; background: #FFFFFF;">                d = -g; % Initially use steepest descent direction</span><br/>               <span style="color: #A0A0A0"> 453</span> <span style="color: #228B22; background: #FFFFFF;">            else</span><br/>               <span style="color: #A0A0A0"> 454</span> <span style="color: #A0A0A0; background: #FFFFFF;">                gtgo = g'*g_old;</span><br/>               <span style="color: #A0A0A0"> 455</span> <span style="color: #A0A0A0; background: #FFFFFF;">                gotgo = g_old'*g_old;</span><br/>               <span style="color: #A0A0A0"> 456</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 457</span> <span style="color: #A0A0A0; background: #FFFFFF;">                if cgUpdate == 0</span><br/>               <span style="color: #A0A0A0"> 458</span> <span style="color: #228B22; background: #FFFFFF;">                    % Fletcher-Reeves</span><br/>               <span style="color: #A0A0A0"> 459</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    beta = (g'*g)/(gotgo);</span><br/>               <span style="color: #A0A0A0"> 460</span> <span style="color: #A0A0A0; background: #FFFFFF;">                elseif cgUpdate == 1</span><br/>               <span style="color: #A0A0A0"> 461</span> <span style="color: #228B22; background: #FFFFFF;">                    % Polak-Ribiere</span><br/>               <span style="color: #A0A0A0"> 462</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    beta = (g'*(g-g_old)) /(gotgo);</span><br/>               <span style="color: #A0A0A0"> 463</span> <span style="color: #A0A0A0; background: #FFFFFF;">                elseif cgUpdate == 2</span><br/>               <span style="color: #A0A0A0"> 464</span> <span style="color: #228B22; background: #FFFFFF;">                    % Hestenes-Stiefel</span><br/>               <span style="color: #A0A0A0"> 465</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    beta = (g'*(g-g_old))/((g-g_old)'*d);</span><br/>               <span style="color: #A0A0A0"> 466</span> <span style="color: #228B22; background: #FFFFFF;">                else</span><br/>               <span style="color: #A0A0A0"> 467</span> <span style="color: #228B22; background: #FFFFFF;">                    % Gilbert-Nocedal</span><br/>               <span style="color: #A0A0A0"> 468</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    beta_FR = (g'*(g-g_old)) /(gotgo);</span><br/>               <span style="color: #A0A0A0"> 469</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    beta_PR = (g'*g-gtgo)/(gotgo);</span><br/>               <span style="color: #A0A0A0"> 470</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    beta = max(-beta_FR,min(beta_PR,beta_FR));</span><br/>               <span style="color: #A0A0A0"> 471</span> <span style="color: #A0A0A0; background: #FFFFFF;">                end</span><br/>               <span style="color: #A0A0A0"> 472</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 473</span> <span style="color: #A0A0A0; background: #FFFFFF;">                d = -g + beta*d;</span><br/>               <span style="color: #A0A0A0"> 474</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 475</span> <span style="color: #228B22; background: #FFFFFF;">                % Restart if not a direction of sufficient descent</span><br/>               <span style="color: #A0A0A0"> 476</span> <span style="color: #A0A0A0; background: #FFFFFF;">                if g'*d &gt; -tolX</span><br/>               <span style="color: #A0A0A0"> 477</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    if debug</span><br/>               <span style="color: #A0A0A0"> 478</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        fprintf('Restarting CG\n');</span><br/>               <span style="color: #A0A0A0"> 479</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/><a name="Line480"></a>               <span style="color: #A0A0A0"> 480</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    beta = 0;</span><br/>               <span style="color: #A0A0A0"> 481</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    d = -g;</span><br/>               <span style="color: #A0A0A0"> 482</span> <span style="color: #A0A0A0; background: #FFFFFF;">                end</span><br/>               <span style="color: #A0A0A0"> 483</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 484</span> <span style="color: #228B22; background: #FFFFFF;">                % Old restart rule:</span><br/>               <span style="color: #A0A0A0"> 485</span> <span style="color: #228B22; background: #FFFFFF;">                %if beta &lt; 0 || abs(gtgo)/(gotgo) &gt;= 0.1 || g'*d &gt;= 0</span><br/>               <span style="color: #A0A0A0"> 486</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 487</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 488</span> <span style="color: #A0A0A0; background: #FFFFFF;">            g_old = g;</span><br/>               <span style="color: #A0A0A0"> 489</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold"> 490</span> <span style="color: #000000; background: #FFFFFF;">        case PCG % Preconditioned Non-Linear Conjugate Gradient </span><br/>               <span style="color: #A0A0A0"> 491</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 492</span> <span style="color: #228B22; background: #FFFFFF;">            % Apply preconditioner to negative gradient</span><br/>               <span style="color: #A0A0A0"> 493</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if isempty(precFunc)</span><br/>               <span style="color: #A0A0A0"> 494</span> <span style="color: #228B22; background: #FFFFFF;">                % Use L-BFGS Preconditioner</span><br/>               <span style="color: #A0A0A0"> 495</span> <span style="color: #A0A0A0; background: #FFFFFF;">                if i == 1</span><br/>               <span style="color: #A0A0A0"> 496</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    old_dirs = zeros(length(g),0);</span><br/>               <span style="color: #A0A0A0"> 497</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    old_stps = zeros(length(g),0);</span><br/>               <span style="color: #A0A0A0"> 498</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    Hdiag = 1;</span><br/>               <span style="color: #A0A0A0"> 499</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    s = -g;</span><br/>               <span style="color: #A0A0A0"> 500</span> <span style="color: #228B22; background: #FFFFFF;">                else</span><br/>               <span style="color: #A0A0A0"> 501</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    [old_dirs,old_stps,Hdiag] = lbfgsUpdate(g-g_old,t*d,corrections,debug,old_dirs,old_stps,Hdiag);</span><br/>               <span style="color: #A0A0A0"> 502</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 503</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    if useMex</span><br/>               <span style="color: #A0A0A0"> 504</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        s = lbfgsC(-g,old_dirs,old_stps,Hdiag);</span><br/>               <span style="color: #A0A0A0"> 505</span> <span style="color: #228B22; background: #FFFFFF;">                    else</span><br/>               <span style="color: #A0A0A0"> 506</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        s = lbfgs(-g,old_dirs,old_stps,Hdiag);</span><br/>               <span style="color: #A0A0A0"> 507</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/>               <span style="color: #A0A0A0"> 508</span> <span style="color: #A0A0A0; background: #FFFFFF;">                end</span><br/>               <span style="color: #A0A0A0"> 509</span> <span style="color: #228B22; background: #FFFFFF;">            else % User-supplied preconditioner</span><br/>               <span style="color: #A0A0A0"> 510</span> <span style="color: #A0A0A0; background: #FFFFFF;">                s = precFunc(-g,x,varargin{:});</span><br/>               <span style="color: #A0A0A0"> 511</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 512</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 513</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if i == 1</span><br/>               <span style="color: #A0A0A0"> 514</span> <span style="color: #A0A0A0; background: #FFFFFF;">                d = s;</span><br/>               <span style="color: #A0A0A0"> 515</span> <span style="color: #228B22; background: #FFFFFF;">            else</span><br/>               <span style="color: #A0A0A0"> 516</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 517</span> <span style="color: #A0A0A0; background: #FFFFFF;">                if cgUpdate == 0</span><br/>               <span style="color: #A0A0A0"> 518</span> <span style="color: #228B22; background: #FFFFFF;">                    % Preconditioned Fletcher-Reeves</span><br/>               <span style="color: #A0A0A0"> 519</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    beta = (g'*s)/(g_old'*s_old);</span><br/>               <span style="color: #A0A0A0"> 520</span> <span style="color: #A0A0A0; background: #FFFFFF;">                elseif cgUpdate &lt; 3</span><br/>               <span style="color: #A0A0A0"> 521</span> <span style="color: #228B22; background: #FFFFFF;">                    % Preconditioned Polak-Ribiere</span><br/>               <span style="color: #A0A0A0"> 522</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    beta = (g'*(s-s_old))/(g_old'*s_old);</span><br/>               <span style="color: #A0A0A0"> 523</span> <span style="color: #228B22; background: #FFFFFF;">                else</span><br/>               <span style="color: #A0A0A0"> 524</span> <span style="color: #228B22; background: #FFFFFF;">                    % Preconditioned Gilbert-Nocedal</span><br/>               <span style="color: #A0A0A0"> 525</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    beta_FR = (g'*s)/(g_old'*s_old);</span><br/>               <span style="color: #A0A0A0"> 526</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    beta_PR = (g'*(s-s_old))/(g_old'*s_old);</span><br/>               <span style="color: #A0A0A0"> 527</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    beta = max(-beta_FR,min(beta_PR,beta_FR));</span><br/>               <span style="color: #A0A0A0"> 528</span> <span style="color: #A0A0A0; background: #FFFFFF;">                end</span><br/>               <span style="color: #A0A0A0"> 529</span> <span style="color: #A0A0A0; background: #FFFFFF;">                d = s + beta*d;</span><br/>               <span style="color: #A0A0A0"> 530</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 531</span> <span style="color: #A0A0A0; background: #FFFFFF;">                if g'*d &gt; -tolX</span><br/>               <span style="color: #A0A0A0"> 532</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    if debug</span><br/>               <span style="color: #A0A0A0"> 533</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        fprintf('Restarting CG\n');</span><br/>               <span style="color: #A0A0A0"> 534</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/><a name="Line535"></a>               <span style="color: #A0A0A0"> 535</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    beta = 0;</span><br/>               <span style="color: #A0A0A0"> 536</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    d = s;</span><br/>               <span style="color: #A0A0A0"> 537</span> <span style="color: #A0A0A0; background: #FFFFFF;">                end</span><br/>               <span style="color: #A0A0A0"> 538</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 539</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 540</span> <span style="color: #A0A0A0; background: #FFFFFF;">            g_old = g;</span><br/>               <span style="color: #A0A0A0"> 541</span> <span style="color: #A0A0A0; background: #FFFFFF;">            s_old = s;</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold"> 542</span> <span style="color: #000000; background: #FFFFFF;">        case LBFGS % L-BFGS </span><br/>               <span style="color: #A0A0A0"> 543</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 544</span> <span style="color: #228B22; background: #FFFFFF;">            % Update the direction and step sizes</span><br/>               <span style="color: #A0A0A0"> 545</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold"> 546</span> <span style="color: #000000; background: #FFFFFF;">            if i == 1 </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 547</span> <span style="color: #000000; background: #FFFFFF;">                d = -g; % Initially use steepest descent direction </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 548</span> <span style="color: #000000; background: #FFFFFF;">                old_dirs = zeros(length(g),0); </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 549</span> <span style="color: #000000; background: #FFFFFF;">                old_stps = zeros(length(d),0); </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 550</span> <span style="color: #000000; background: #FFFFFF;">                Hdiag = 1; </span><br/>       <span style="color: #0000FF">    399 </span><span style="color: #000000; font-weight: bold"> 551</span> <span style="color: #228B22; background: #FFFFFF;">            else </span><br/>       <span style="color: #0000FF">    399 </span><span style="color: #000000; font-weight: bold"> 552</span> <span style="color: #000000; background: #FFFFFF;">                if Damped </span><br/>               <span style="color: #A0A0A0"> 553</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    [old_dirs,old_stps,Hdiag] = dampedUpdate(g-g_old,t*d,corrections,debug,old_dirs,old_stps,Hdiag);</span><br/>       <span style="color: #0000FF">    399 </span><span style="color: #000000; font-weight: bold"> 554</span> <span style="color: #228B22; background: #FFFFFF;">                else </span><br/><span style="color: #FF0000"> 75.26 </span><span style="color: #0000FF">    399 </span><span style="color: #000000; font-weight: bold"> 555</span> <a name="Line555"></a><span style="color: #000000; background: #FFFFFF;">                    [old_dirs,old_stps,Hdiag] = <a href="file59.html">lbfgsUpdate</a>(g-g_old,t*d,corrections,debug,old_dirs,old_stps,Hdiag); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    399 </span><span style="color: #000000; font-weight: bold"> 556</span> <span style="color: #000000; background: #FFFFFF;">                end </span><br/>               <span style="color: #A0A0A0"> 557</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    399 </span><span style="color: #000000; font-weight: bold"> 558</span> <span style="color: #000000; background: #FFFFFF;">                if useMex </span><br/><span style="color: #FF0000"> 78.28 </span><span style="color: #0000FF">    399 </span><span style="color: #000000; font-weight: bold"> 559</span> <a name="Line559"></a><span style="color: #000000; background: #FFFFFF;">                    d = <a href="file60.html">lbfgsC</a>(-g,old_dirs,old_stps,Hdiag); </span><br/>               <span style="color: #A0A0A0"> 560</span> <span style="color: #228B22; background: #FFFFFF;">                else</span><br/>               <span style="color: #A0A0A0"> 561</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    d = lbfgs(-g,old_dirs,old_stps,Hdiag);</span><br/>               <span style="color: #A0A0A0"> 562</span> <span style="color: #A0A0A0; background: #FFFFFF;">                end</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    399 </span><span style="color: #000000; font-weight: bold"> 563</span> <span style="color: #000000; background: #FFFFFF;">            end </span><br/><span style="color: #FF0000">  0.05 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold"> 564</span> <span style="color: #000000; background: #FFFFFF;">            g_old = g; </span><br/>               <span style="color: #A0A0A0"> 565</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 566</span> <span style="color: #A0A0A0; background: #FFFFFF;">        case QNEWTON % Use quasi-Newton Hessian approximation</span><br/>               <span style="color: #A0A0A0"> 567</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 568</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if i == 1</span><br/>               <span style="color: #A0A0A0"> 569</span> <span style="color: #A0A0A0; background: #FFFFFF;">                d = -g;</span><br/>               <span style="color: #A0A0A0"> 570</span> <span style="color: #228B22; background: #FFFFFF;">            else</span><br/>               <span style="color: #A0A0A0"> 571</span> <span style="color: #228B22; background: #FFFFFF;">                % Compute difference vectors</span><br/>               <span style="color: #A0A0A0"> 572</span> <span style="color: #A0A0A0; background: #FFFFFF;">                y = g-g_old;</span><br/>               <span style="color: #A0A0A0"> 573</span> <span style="color: #A0A0A0; background: #FFFFFF;">                s = t*d;</span><br/>               <span style="color: #A0A0A0"> 574</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 575</span> <span style="color: #A0A0A0; background: #FFFFFF;">                if i == 2</span><br/>               <span style="color: #A0A0A0"> 576</span> <span style="color: #228B22; background: #FFFFFF;">                    % Make initial Hessian approximation</span><br/>               <span style="color: #A0A0A0"> 577</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    if initialHessType == 0</span><br/>               <span style="color: #A0A0A0"> 578</span> <span style="color: #228B22; background: #FFFFFF;">                        % Identity</span><br/>               <span style="color: #A0A0A0"> 579</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        if qnUpdate &lt;= 1</span><br/>               <span style="color: #A0A0A0"> 580</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            R = eye(length(g));</span><br/>               <span style="color: #A0A0A0"> 581</span> <span style="color: #228B22; background: #FFFFFF;">                        else</span><br/>               <span style="color: #A0A0A0"> 582</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            H = eye(length(g));</span><br/>               <span style="color: #A0A0A0"> 583</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        end</span><br/>               <span style="color: #A0A0A0"> 584</span> <span style="color: #228B22; background: #FFFFFF;">                    else</span><br/>               <span style="color: #A0A0A0"> 585</span> <span style="color: #228B22; background: #FFFFFF;">                        % Scaled Identity</span><br/>               <span style="color: #A0A0A0"> 586</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        if debug</span><br/>               <span style="color: #A0A0A0"> 587</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            fprintf('Scaling Initial Hessian Approximation\n');</span><br/>               <span style="color: #A0A0A0"> 588</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        end</span><br/>               <span style="color: #A0A0A0"> 589</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        if qnUpdate &lt;= 1</span><br/>               <span style="color: #A0A0A0"> 590</span> <span style="color: #228B22; background: #FFFFFF;">                            % Use Cholesky of Hessian approximation</span><br/>               <span style="color: #A0A0A0"> 591</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            R = sqrt((y'*y)/(y'*s))*eye(length(g));</span><br/>               <span style="color: #A0A0A0"> 592</span> <span style="color: #228B22; background: #FFFFFF;">                        else</span><br/>               <span style="color: #A0A0A0"> 593</span> <span style="color: #228B22; background: #FFFFFF;">                            % Use Inverse of Hessian approximation</span><br/>               <span style="color: #A0A0A0"> 594</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            H = eye(length(g))*(y'*s)/(y'*y);</span><br/>               <span style="color: #A0A0A0"> 595</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        end</span><br/>               <span style="color: #A0A0A0"> 596</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/>               <span style="color: #A0A0A0"> 597</span> <span style="color: #A0A0A0; background: #FFFFFF;">                end</span><br/>               <span style="color: #A0A0A0"> 598</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 599</span> <span style="color: #A0A0A0; background: #FFFFFF;">                if qnUpdate == 0 % Use BFGS updates</span><br/>               <span style="color: #A0A0A0"> 600</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    Bs = R'*(R*s);</span><br/>               <span style="color: #A0A0A0"> 601</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    if Damped</span><br/>               <span style="color: #A0A0A0"> 602</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        eta = .02;</span><br/>               <span style="color: #A0A0A0"> 603</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        if y'*s &lt; eta*s'*Bs</span><br/>               <span style="color: #A0A0A0"> 604</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            if debug</span><br/>               <span style="color: #A0A0A0"> 605</span> <span style="color: #A0A0A0; background: #FFFFFF;">                                fprintf('Damped Update\n');</span><br/>               <span style="color: #A0A0A0"> 606</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            end</span><br/>               <span style="color: #A0A0A0"> 607</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            theta = min(max(0,((1-eta)*s'*Bs)/(s'*Bs - y'*s)),1);</span><br/>               <span style="color: #A0A0A0"> 608</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            y = theta*y + (1-theta)*Bs;</span><br/>               <span style="color: #A0A0A0"> 609</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        end</span><br/>               <span style="color: #A0A0A0"> 610</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        R = cholupdate(cholupdate(R,y/sqrt(y'*s)),Bs/sqrt(s'*Bs),'-');</span><br/>               <span style="color: #A0A0A0"> 611</span> <span style="color: #228B22; background: #FFFFFF;">                    else</span><br/>               <span style="color: #A0A0A0"> 612</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        if y'*s &gt; 1e-10</span><br/>               <span style="color: #A0A0A0"> 613</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            R = cholupdate(cholupdate(R,y/sqrt(y'*s)),Bs/sqrt(s'*Bs),'-');</span><br/>               <span style="color: #A0A0A0"> 614</span> <span style="color: #228B22; background: #FFFFFF;">                        else</span><br/>               <span style="color: #A0A0A0"> 615</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            if debug</span><br/>               <span style="color: #A0A0A0"> 616</span> <span style="color: #A0A0A0; background: #FFFFFF;">                                fprintf('Skipping Update\n');</span><br/>               <span style="color: #A0A0A0"> 617</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            end</span><br/>               <span style="color: #A0A0A0"> 618</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        end</span><br/>               <span style="color: #A0A0A0"> 619</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/>               <span style="color: #A0A0A0"> 620</span> <span style="color: #A0A0A0; background: #FFFFFF;">                elseif qnUpdate == 1 % Perform SR1 Update if it maintains positive-definiteness</span><br/>               <span style="color: #A0A0A0"> 621</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 622</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    Bs = R'*(R*s);</span><br/>               <span style="color: #A0A0A0"> 623</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    ymBs = y-Bs;</span><br/>               <span style="color: #A0A0A0"> 624</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    if abs(s'*ymBs) &gt;= norm(s)*norm(ymBs)*1e-8 &amp;&amp; (s-((R\(R'\y))))'*y &gt; 1e-10</span><br/>               <span style="color: #A0A0A0"> 625</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        R = cholupdate(R,-ymBs/sqrt(ymBs'*s),'-');</span><br/>               <span style="color: #A0A0A0"> 626</span> <span style="color: #228B22; background: #FFFFFF;">                    else</span><br/>               <span style="color: #A0A0A0"> 627</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        if debug</span><br/>               <span style="color: #A0A0A0"> 628</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            fprintf('SR1 not positive-definite, doing BFGS Update\n');</span><br/>               <span style="color: #A0A0A0"> 629</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        end</span><br/>               <span style="color: #A0A0A0"> 630</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        if Damped</span><br/>               <span style="color: #A0A0A0"> 631</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            eta = .02;</span><br/>               <span style="color: #A0A0A0"> 632</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            if y'*s &lt; eta*s'*Bs</span><br/>               <span style="color: #A0A0A0"> 633</span> <span style="color: #A0A0A0; background: #FFFFFF;">                                if debug</span><br/>               <span style="color: #A0A0A0"> 634</span> <span style="color: #A0A0A0; background: #FFFFFF;">                                    fprintf('Damped Update\n');</span><br/>               <span style="color: #A0A0A0"> 635</span> <span style="color: #A0A0A0; background: #FFFFFF;">                                end</span><br/>               <span style="color: #A0A0A0"> 636</span> <span style="color: #A0A0A0; background: #FFFFFF;">                                theta = min(max(0,((1-eta)*s'*Bs)/(s'*Bs - y'*s)),1);</span><br/>               <span style="color: #A0A0A0"> 637</span> <span style="color: #A0A0A0; background: #FFFFFF;">                                y = theta*y + (1-theta)*Bs;</span><br/>               <span style="color: #A0A0A0"> 638</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            end</span><br/>               <span style="color: #A0A0A0"> 639</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            R = cholupdate(cholupdate(R,y/sqrt(y'*s)),Bs/sqrt(s'*Bs),'-');</span><br/>               <span style="color: #A0A0A0"> 640</span> <span style="color: #228B22; background: #FFFFFF;">                        else</span><br/>               <span style="color: #A0A0A0"> 641</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            if y'*s &gt; 1e-10</span><br/>               <span style="color: #A0A0A0"> 642</span> <span style="color: #A0A0A0; background: #FFFFFF;">                                R = cholupdate(cholupdate(R,y/sqrt(y'*s)),Bs/sqrt(s'*Bs),'-');</span><br/>               <span style="color: #A0A0A0"> 643</span> <span style="color: #228B22; background: #FFFFFF;">                            else</span><br/>               <span style="color: #A0A0A0"> 644</span> <span style="color: #A0A0A0; background: #FFFFFF;">                                if debug</span><br/>               <span style="color: #A0A0A0"> 645</span> <span style="color: #A0A0A0; background: #FFFFFF;">                                    fprintf('Skipping Update\n');</span><br/>               <span style="color: #A0A0A0"> 646</span> <span style="color: #A0A0A0; background: #FFFFFF;">                                end</span><br/>               <span style="color: #A0A0A0"> 647</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            end</span><br/>               <span style="color: #A0A0A0"> 648</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        end</span><br/>               <span style="color: #A0A0A0"> 649</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/>               <span style="color: #A0A0A0"> 650</span> <span style="color: #A0A0A0; background: #FFFFFF;">                elseif qnUpdate == 2 % Use Hoshino update</span><br/>               <span style="color: #A0A0A0"> 651</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    v = sqrt(y'*H*y)*(s/(s'*y) - (H*y)/(y'*H*y));</span><br/>               <span style="color: #A0A0A0"> 652</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    phi = 1/(1 + (y'*H*y)/(s'*y));</span><br/><a name="Line653"></a>               <span style="color: #A0A0A0"> 653</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    H = H + (s*s')/(s'*y) - (H*y*y'*H)/(y'*H*y) + phi*v*v';</span><br/>               <span style="color: #A0A0A0"> 654</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 655</span> <span style="color: #A0A0A0; background: #FFFFFF;">                elseif qnUpdate == 3 % Self-Scaling BFGS update</span><br/>               <span style="color: #A0A0A0"> 656</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    ys = y'*s;</span><br/>               <span style="color: #A0A0A0"> 657</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    Hy = H*y;</span><br/>               <span style="color: #A0A0A0"> 658</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    yHy = y'*Hy;</span><br/>               <span style="color: #A0A0A0"> 659</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    gamma = ys/yHy;</span><br/>               <span style="color: #A0A0A0"> 660</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    v = sqrt(yHy)*(s/ys - Hy/yHy);</span><br/>               <span style="color: #A0A0A0"> 661</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    H = gamma*(H - Hy*Hy'/yHy + v*v') + (s*s')/ys;</span><br/>               <span style="color: #A0A0A0"> 662</span> <span style="color: #A0A0A0; background: #FFFFFF;">                elseif qnUpdate == 4 % Oren's Self-Scaling Variable Metric update</span><br/>               <span style="color: #A0A0A0"> 663</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 664</span> <span style="color: #228B22; background: #FFFFFF;">                    % Oren's method</span><br/>               <span style="color: #A0A0A0"> 665</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    if (s'*y)/(y'*H*y) &gt; 1</span><br/>               <span style="color: #A0A0A0"> 666</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        phi = 1; % BFGS</span><br/>               <span style="color: #A0A0A0"> 667</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        omega = 0;</span><br/>               <span style="color: #A0A0A0"> 668</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    elseif (s'*(H\s))/(s'*y) &lt; 1</span><br/>               <span style="color: #A0A0A0"> 669</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        phi = 0; % DFP</span><br/>               <span style="color: #A0A0A0"> 670</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        omega = 1;</span><br/>               <span style="color: #A0A0A0"> 671</span> <span style="color: #228B22; background: #FFFFFF;">                    else</span><br/>               <span style="color: #A0A0A0"> 672</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        phi = (s'*y)*(y'*H*y-s'*y)/((s'*(H\s))*(y'*H*y)-(s'*y)^2);</span><br/>               <span style="color: #A0A0A0"> 673</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        omega = phi;</span><br/>               <span style="color: #A0A0A0"> 674</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/>               <span style="color: #A0A0A0"> 675</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 676</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    gamma = (1-omega)*(s'*y)/(y'*H*y) + omega*(s'*(H\s))/(s'*y);</span><br/>               <span style="color: #A0A0A0"> 677</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    v = sqrt(y'*H*y)*(s/(s'*y) - (H*y)/(y'*H*y));</span><br/><a name="Line678"></a>               <span style="color: #A0A0A0"> 678</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    H = gamma*(H - (H*y*y'*H)/(y'*H*y) + phi*v*v') + (s*s')/(s'*y);</span><br/>               <span style="color: #A0A0A0"> 679</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 680</span> <span style="color: #A0A0A0; background: #FFFFFF;">                elseif qnUpdate == 5 % McCormick-Huang asymmetric update</span><br/>               <span style="color: #A0A0A0"> 681</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    theta = 1;</span><br/>               <span style="color: #A0A0A0"> 682</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    phi = 0;</span><br/>               <span style="color: #A0A0A0"> 683</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    psi = 1;</span><br/>               <span style="color: #A0A0A0"> 684</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    omega = 0;</span><br/>               <span style="color: #A0A0A0"> 685</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    t1 = s*(theta*s + phi*H'*y)';</span><br/>               <span style="color: #A0A0A0"> 686</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    t2 = (theta*s + phi*H'*y)'*y;</span><br/>               <span style="color: #A0A0A0"> 687</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    t3 = H*y*(psi*s + omega*H'*y)';</span><br/>               <span style="color: #A0A0A0"> 688</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    t4 = (psi*s + omega*H'*y)'*y;</span><br/>               <span style="color: #A0A0A0"> 689</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    H = H + t1/t2 - t3/t4;</span><br/>               <span style="color: #A0A0A0"> 690</span> <span style="color: #A0A0A0; background: #FFFFFF;">                end</span><br/>               <span style="color: #A0A0A0"> 691</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 692</span> <span style="color: #A0A0A0; background: #FFFFFF;">                if qnUpdate &lt;= 1</span><br/>               <span style="color: #A0A0A0"> 693</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    d = -R\(R'\g);</span><br/>               <span style="color: #A0A0A0"> 694</span> <span style="color: #228B22; background: #FFFFFF;">                else</span><br/>               <span style="color: #A0A0A0"> 695</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    d = -H*g;</span><br/>               <span style="color: #A0A0A0"> 696</span> <span style="color: #A0A0A0; background: #FFFFFF;">                end</span><br/>               <span style="color: #A0A0A0"> 697</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 698</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 699</span> <span style="color: #A0A0A0; background: #FFFFFF;">            g_old = g;</span><br/>               <span style="color: #A0A0A0"> 700</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 701</span> <span style="color: #A0A0A0; background: #FFFFFF;">        case NEWTON0 % Hessian-Free Newton</span><br/>               <span style="color: #A0A0A0"> 702</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 703</span> <span style="color: #A0A0A0; background: #FFFFFF;">            cgMaxIter = min(p,maxFunEvals-funEvals);</span><br/>               <span style="color: #A0A0A0"> 704</span> <span style="color: #A0A0A0; background: #FFFFFF;">            cgForce = min(0.5,sqrt(norm(g)))*norm(g);</span><br/>               <span style="color: #A0A0A0"> 705</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 706</span> <span style="color: #228B22; background: #FFFFFF;">            % Set-up preconditioner</span><br/>               <span style="color: #A0A0A0"> 707</span> <span style="color: #A0A0A0; background: #FFFFFF;">            precondFunc = [];</span><br/>               <span style="color: #A0A0A0"> 708</span> <span style="color: #A0A0A0; background: #FFFFFF;">            precondArgs = [];</span><br/>               <span style="color: #A0A0A0"> 709</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if cgSolve == 1</span><br/>               <span style="color: #A0A0A0"> 710</span> <span style="color: #A0A0A0; background: #FFFFFF;">                if isempty(precFunc) % Apply L-BFGS preconditioner</span><br/>               <span style="color: #A0A0A0"> 711</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    if i == 1</span><br/>               <span style="color: #A0A0A0"> 712</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        old_dirs = zeros(length(g),0);</span><br/>               <span style="color: #A0A0A0"> 713</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        old_stps = zeros(length(g),0);</span><br/>               <span style="color: #A0A0A0"> 714</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        Hdiag = 1;</span><br/>               <span style="color: #A0A0A0"> 715</span> <span style="color: #228B22; background: #FFFFFF;">                    else</span><br/>               <span style="color: #A0A0A0"> 716</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        [old_dirs,old_stps,Hdiag] = lbfgsUpdate(g-g_old,t*d,corrections,debug,old_dirs,old_stps,Hdiag);</span><br/>               <span style="color: #A0A0A0"> 717</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        if useMex</span><br/>               <span style="color: #A0A0A0"> 718</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            precondFunc = @lbfgsC;</span><br/>               <span style="color: #A0A0A0"> 719</span> <span style="color: #228B22; background: #FFFFFF;">                        else</span><br/>               <span style="color: #A0A0A0"> 720</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            precondFunc = @lbfgs;</span><br/>               <span style="color: #A0A0A0"> 721</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        end</span><br/>               <span style="color: #A0A0A0"> 722</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        precondArgs = {old_dirs,old_stps,Hdiag};</span><br/>               <span style="color: #A0A0A0"> 723</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/>               <span style="color: #A0A0A0"> 724</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    g_old = g;</span><br/>               <span style="color: #A0A0A0"> 725</span> <span style="color: #228B22; background: #FFFFFF;">                else</span><br/>               <span style="color: #A0A0A0"> 726</span> <span style="color: #228B22; background: #FFFFFF;">                    % Apply user-defined preconditioner</span><br/>               <span style="color: #A0A0A0"> 727</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    precondFunc = precFunc;</span><br/><a name="Line728"></a>               <span style="color: #A0A0A0"> 728</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    precondArgs = {x,varargin{:}};</span><br/>               <span style="color: #A0A0A0"> 729</span> <span style="color: #A0A0A0; background: #FFFFFF;">                end</span><br/>               <span style="color: #A0A0A0"> 730</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 731</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 732</span> <span style="color: #228B22; background: #FFFFFF;">            % Solve Newton system using cg and hessian-vector products</span><br/>               <span style="color: #A0A0A0"> 733</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if isempty(HvFunc)</span><br/>               <span style="color: #A0A0A0"> 734</span> <span style="color: #228B22; background: #FFFFFF;">                % No user-supplied Hessian-vector function,</span><br/>               <span style="color: #A0A0A0"> 735</span> <span style="color: #228B22; background: #FFFFFF;">                % use automatic differentiation</span><br/>               <span style="color: #A0A0A0"> 736</span> <span style="color: #A0A0A0; background: #FFFFFF;">                HvFun = @autoHv;</span><br/><a name="Line737"></a>               <span style="color: #A0A0A0"> 737</span> <span style="color: #A0A0A0; background: #FFFFFF;">                HvArgs = {x,g,useComplex,funObj,varargin{:}};</span><br/>               <span style="color: #A0A0A0"> 738</span> <span style="color: #228B22; background: #FFFFFF;">            else</span><br/>               <span style="color: #A0A0A0"> 739</span> <span style="color: #228B22; background: #FFFFFF;">                % Use user-supplid Hessian-vector function</span><br/>               <span style="color: #A0A0A0"> 740</span> <span style="color: #A0A0A0; background: #FFFFFF;">                HvFun = HvFunc;</span><br/><a name="Line741"></a>               <span style="color: #A0A0A0"> 741</span> <span style="color: #A0A0A0; background: #FFFFFF;">                HvArgs = {x,varargin{:}};</span><br/>               <span style="color: #A0A0A0"> 742</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 743</span> <span style="color: #228B22; background: #FFFFFF;">            </span><br/>               <span style="color: #A0A0A0"> 744</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if useNegCurv</span><br/>               <span style="color: #A0A0A0"> 745</span> <span style="color: #A0A0A0; background: #FFFFFF;">                [d,cgIter,cgRes,negCurv] = conjGrad([],-g,cgForce,cgMaxIter,debug,precondFunc,precondArgs,HvFun,HvArgs);</span><br/>               <span style="color: #A0A0A0"> 746</span> <span style="color: #228B22; background: #FFFFFF;">            else</span><br/>               <span style="color: #A0A0A0"> 747</span> <span style="color: #A0A0A0; background: #FFFFFF;">                [d,cgIter,cgRes] = conjGrad([],-g,cgForce,cgMaxIter,debug,precondFunc,precondArgs,HvFun,HvArgs);</span><br/>               <span style="color: #A0A0A0"> 748</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 749</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 750</span> <span style="color: #A0A0A0; background: #FFFFFF;">            funEvals = funEvals+cgIter;</span><br/>               <span style="color: #A0A0A0"> 751</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if debug</span><br/>               <span style="color: #A0A0A0"> 752</span> <span style="color: #A0A0A0; background: #FFFFFF;">                fprintf('newtonCG stopped on iteration %d w/ residual %.5e\n',cgIter,cgRes);</span><br/>               <span style="color: #A0A0A0"> 753</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 754</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 755</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 756</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if useNegCurv</span><br/>               <span style="color: #A0A0A0"> 757</span> <span style="color: #A0A0A0; background: #FFFFFF;">                if ~isempty(negCurv)</span><br/>               <span style="color: #A0A0A0"> 758</span> <span style="color: #228B22; background: #FFFFFF;">                    %if debug</span><br/>               <span style="color: #A0A0A0"> 759</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    fprintf('Using negative curvature direction\n');</span><br/>               <span style="color: #A0A0A0"> 760</span> <span style="color: #228B22; background: #FFFFFF;">                    %end</span><br/>               <span style="color: #A0A0A0"> 761</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    d = negCurv/norm(negCurv);</span><br/>               <span style="color: #A0A0A0"> 762</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    d = d/sum(abs(g));</span><br/>               <span style="color: #A0A0A0"> 763</span> <span style="color: #A0A0A0; background: #FFFFFF;">                end</span><br/>               <span style="color: #A0A0A0"> 764</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 765</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 766</span> <span style="color: #A0A0A0; background: #FFFFFF;">        case NEWTON % Newton search direction</span><br/>               <span style="color: #A0A0A0"> 767</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 768</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if cgSolve == 0</span><br/>               <span style="color: #A0A0A0"> 769</span> <span style="color: #A0A0A0; background: #FFFFFF;">                if HessianModify == 0</span><br/>               <span style="color: #A0A0A0"> 770</span> <span style="color: #228B22; background: #FFFFFF;">                    % Attempt to perform a Cholesky factorization of the Hessian</span><br/>               <span style="color: #A0A0A0"> 771</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    [R,posDef] = chol(H);</span><br/>               <span style="color: #A0A0A0"> 772</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 773</span> <span style="color: #228B22; background: #FFFFFF;">                    % If the Cholesky factorization was successful, then the Hessian is</span><br/>               <span style="color: #A0A0A0"> 774</span> <span style="color: #228B22; background: #FFFFFF;">                    % positive definite, solve the system</span><br/>               <span style="color: #A0A0A0"> 775</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    if posDef == 0</span><br/>               <span style="color: #A0A0A0"> 776</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        d = -R\(R'\g);</span><br/>               <span style="color: #A0A0A0"> 777</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 778</span> <span style="color: #228B22; background: #FFFFFF;">                    else</span><br/>               <span style="color: #A0A0A0"> 779</span> <span style="color: #228B22; background: #FFFFFF;">                        % otherwise, adjust the Hessian to be positive definite based on the</span><br/>               <span style="color: #A0A0A0"> 780</span> <span style="color: #228B22; background: #FFFFFF;">                        % minimum eigenvalue, and solve with QR</span><br/>               <span style="color: #A0A0A0"> 781</span> <span style="color: #228B22; background: #FFFFFF;">                        % (expensive, we don't want to do this very much)</span><br/>               <span style="color: #A0A0A0"> 782</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        if debug</span><br/>               <span style="color: #A0A0A0"> 783</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            fprintf('Adjusting Hessian\n');</span><br/>               <span style="color: #A0A0A0"> 784</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        end</span><br/>               <span style="color: #A0A0A0"> 785</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        H = H + eye(length(g)) * max(0,1e-12 - min(real(eig(H))));</span><br/>               <span style="color: #A0A0A0"> 786</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        d = -H\g;</span><br/>               <span style="color: #A0A0A0"> 787</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/>               <span style="color: #A0A0A0"> 788</span> <span style="color: #A0A0A0; background: #FFFFFF;">                elseif HessianModify == 1</span><br/>               <span style="color: #A0A0A0"> 789</span> <span style="color: #228B22; background: #FFFFFF;">                    % Modified Incomplete Cholesky</span><br/>               <span style="color: #A0A0A0"> 790</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    R = mcholinc(H,debug);</span><br/>               <span style="color: #A0A0A0"> 791</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    d = -R\(R'\g);</span><br/>               <span style="color: #A0A0A0"> 792</span> <span style="color: #A0A0A0; background: #FFFFFF;">                elseif HessianModify == 2</span><br/>               <span style="color: #A0A0A0"> 793</span> <span style="color: #228B22; background: #FFFFFF;">                    % Modified Generalized Cholesky</span><br/>               <span style="color: #A0A0A0"> 794</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    if useMex</span><br/><a name="Line795"></a>               <span style="color: #A0A0A0"> 795</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        [L D perm] = mcholC(H);</span><br/>               <span style="color: #A0A0A0"> 796</span> <span style="color: #228B22; background: #FFFFFF;">                    else</span><br/><a name="Line797"></a>               <span style="color: #A0A0A0"> 797</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        [L D perm] = mchol(H);</span><br/>               <span style="color: #A0A0A0"> 798</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/>               <span style="color: #A0A0A0"> 799</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    d(perm) = -L' \ ((D.^-1).*(L \ g(perm)));</span><br/>               <span style="color: #A0A0A0"> 800</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 801</span> <span style="color: #A0A0A0; background: #FFFFFF;">                elseif HessianModify == 3</span><br/>               <span style="color: #A0A0A0"> 802</span> <span style="color: #228B22; background: #FFFFFF;">                    % Modified Spectral Decomposition</span><br/>               <span style="color: #A0A0A0"> 803</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    [V,D] = eig((H+H')/2);</span><br/>               <span style="color: #A0A0A0"> 804</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    D = diag(D);</span><br/>               <span style="color: #A0A0A0"> 805</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    D = max(abs(D),max(max(abs(D)),1)*1e-12);</span><br/>               <span style="color: #A0A0A0"> 806</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    d = -V*((V'*g)./D);</span><br/>               <span style="color: #A0A0A0"> 807</span> <span style="color: #A0A0A0; background: #FFFFFF;">                elseif HessianModify == 4</span><br/>               <span style="color: #A0A0A0"> 808</span> <span style="color: #228B22; background: #FFFFFF;">                    % Modified Symmetric Indefinite Factorization</span><br/>               <span style="color: #A0A0A0"> 809</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    [L,D,perm] = ldl(H,'vector');</span><br/><a name="Line810"></a>               <span style="color: #A0A0A0"> 810</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    [blockPos junk] = find(triu(D,1));</span><br/>               <span style="color: #A0A0A0"> 811</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    for diagInd = setdiff(setdiff(1:p,blockPos),blockPos+1)</span><br/>               <span style="color: #A0A0A0"> 812</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        if D(diagInd,diagInd) &lt; 1e-12</span><br/>               <span style="color: #A0A0A0"> 813</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            D(diagInd,diagInd) = 1e-12;</span><br/>               <span style="color: #A0A0A0"> 814</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        end</span><br/>               <span style="color: #A0A0A0"> 815</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/>               <span style="color: #A0A0A0"> 816</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    for blockInd = blockPos'</span><br/>               <span style="color: #A0A0A0"> 817</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        block = D(blockInd:blockInd+1,blockInd:blockInd+1);</span><br/>               <span style="color: #A0A0A0"> 818</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        block_a = block(1);</span><br/>               <span style="color: #A0A0A0"> 819</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        block_b = block(2);</span><br/>               <span style="color: #A0A0A0"> 820</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        block_d = block(4);</span><br/>               <span style="color: #A0A0A0"> 821</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        lambda = (block_a+block_d)/2 - sqrt(4*block_b^2 + (block_a - block_d)^2)/2;</span><br/>               <span style="color: #A0A0A0"> 822</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        D(blockInd:blockInd+1,blockInd:blockInd+1) = block+eye(2)*(lambda+1e-12);</span><br/>               <span style="color: #A0A0A0"> 823</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/>               <span style="color: #A0A0A0"> 824</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    d(perm) = -L' \ (D \ (L \ g(perm)));</span><br/>               <span style="color: #A0A0A0"> 825</span> <span style="color: #228B22; background: #FFFFFF;">                else</span><br/>               <span style="color: #A0A0A0"> 826</span> <span style="color: #228B22; background: #FFFFFF;">                    % Take Newton step if Hessian is pd,</span><br/>               <span style="color: #A0A0A0"> 827</span> <span style="color: #228B22; background: #FFFFFF;">                    % otherwise take a step with negative curvature</span><br/>               <span style="color: #A0A0A0"> 828</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    [R,posDef] = chol(H);</span><br/>               <span style="color: #A0A0A0"> 829</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    if posDef == 0</span><br/>               <span style="color: #A0A0A0"> 830</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        d = -R\(R'\g);</span><br/>               <span style="color: #A0A0A0"> 831</span> <span style="color: #228B22; background: #FFFFFF;">                    else</span><br/>               <span style="color: #A0A0A0"> 832</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        if debug</span><br/>               <span style="color: #A0A0A0"> 833</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            fprintf('Taking Direction of Negative Curvature\n');</span><br/>               <span style="color: #A0A0A0"> 834</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        end</span><br/><a name="Line835"></a>               <span style="color: #A0A0A0"> 835</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        [V,D] = eig(H);</span><br/>               <span style="color: #A0A0A0"> 836</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        u = V(:,1);</span><br/>               <span style="color: #A0A0A0"> 837</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        d = -sign(u'*g)*u;</span><br/>               <span style="color: #A0A0A0"> 838</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/>               <span style="color: #A0A0A0"> 839</span> <span style="color: #A0A0A0; background: #FFFFFF;">                end</span><br/>               <span style="color: #A0A0A0"> 840</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 841</span> <span style="color: #228B22; background: #FFFFFF;">            else</span><br/>               <span style="color: #A0A0A0"> 842</span> <span style="color: #228B22; background: #FFFFFF;">                % Solve with Conjugate Gradient</span><br/>               <span style="color: #A0A0A0"> 843</span> <span style="color: #A0A0A0; background: #FFFFFF;">                cgMaxIter = p;</span><br/>               <span style="color: #A0A0A0"> 844</span> <span style="color: #A0A0A0; background: #FFFFFF;">                cgForce = min(0.5,sqrt(norm(g)))*norm(g);</span><br/>               <span style="color: #A0A0A0"> 845</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 846</span> <span style="color: #228B22; background: #FFFFFF;">                % Select Preconditioner</span><br/>               <span style="color: #A0A0A0"> 847</span> <span style="color: #A0A0A0; background: #FFFFFF;">                if cgSolve == 1</span><br/>               <span style="color: #A0A0A0"> 848</span> <span style="color: #228B22; background: #FFFFFF;">                    % No preconditioner</span><br/>               <span style="color: #A0A0A0"> 849</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    precondFunc = [];</span><br/>               <span style="color: #A0A0A0"> 850</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    precondArgs = [];</span><br/>               <span style="color: #A0A0A0"> 851</span> <span style="color: #A0A0A0; background: #FFFFFF;">                elseif cgSolve == 2</span><br/>               <span style="color: #A0A0A0"> 852</span> <span style="color: #228B22; background: #FFFFFF;">                    % Diagonal preconditioner</span><br/>               <span style="color: #A0A0A0"> 853</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    precDiag = diag(H);</span><br/>               <span style="color: #A0A0A0"> 854</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    precDiag(precDiag &lt; 1e-12) = 1e-12 - min(precDiag);</span><br/>               <span style="color: #A0A0A0"> 855</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    precondFunc = @precondDiag;</span><br/>               <span style="color: #A0A0A0"> 856</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    precondArgs = {precDiag.^-1};</span><br/>               <span style="color: #A0A0A0"> 857</span> <span style="color: #A0A0A0; background: #FFFFFF;">                elseif cgSolve == 3</span><br/>               <span style="color: #A0A0A0"> 858</span> <span style="color: #228B22; background: #FFFFFF;">                    % L-BFGS preconditioner</span><br/>               <span style="color: #A0A0A0"> 859</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    if i == 1</span><br/>               <span style="color: #A0A0A0"> 860</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        old_dirs = zeros(length(g),0);</span><br/>               <span style="color: #A0A0A0"> 861</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        old_stps = zeros(length(g),0);</span><br/>               <span style="color: #A0A0A0"> 862</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        Hdiag = 1;</span><br/>               <span style="color: #A0A0A0"> 863</span> <span style="color: #228B22; background: #FFFFFF;">                    else</span><br/>               <span style="color: #A0A0A0"> 864</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        [old_dirs,old_stps,Hdiag] = lbfgsUpdate(g-g_old,t*d,corrections,debug,old_dirs,old_stps,Hdiag);</span><br/>               <span style="color: #A0A0A0"> 865</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/>               <span style="color: #A0A0A0"> 866</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    g_old = g;</span><br/>               <span style="color: #A0A0A0"> 867</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    if useMex</span><br/>               <span style="color: #A0A0A0"> 868</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        precondFunc = @lbfgsC;</span><br/>               <span style="color: #A0A0A0"> 869</span> <span style="color: #228B22; background: #FFFFFF;">                    else</span><br/>               <span style="color: #A0A0A0"> 870</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        precondFunc = @lbfgs;</span><br/>               <span style="color: #A0A0A0"> 871</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/>               <span style="color: #A0A0A0"> 872</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    precondArgs = {old_dirs,old_stps,Hdiag};</span><br/>               <span style="color: #A0A0A0"> 873</span> <span style="color: #A0A0A0; background: #FFFFFF;">                elseif cgSolve &gt; 0</span><br/>               <span style="color: #A0A0A0"> 874</span> <span style="color: #228B22; background: #FFFFFF;">                    % Symmetric Successive Overelaxation Preconditioner</span><br/>               <span style="color: #A0A0A0"> 875</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    omega = cgSolve;</span><br/>               <span style="color: #A0A0A0"> 876</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    D = diag(H);</span><br/>               <span style="color: #A0A0A0"> 877</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    D(D &lt; 1e-12) = 1e-12 - min(D);</span><br/>               <span style="color: #A0A0A0"> 878</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    precDiag = (omega/(2-omega))*D.^-1;</span><br/>               <span style="color: #A0A0A0"> 879</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    precTriu = diag(D/omega) + triu(H,1);</span><br/>               <span style="color: #A0A0A0"> 880</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    precondFunc = @precondTriuDiag;</span><br/>               <span style="color: #A0A0A0"> 881</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    precondArgs = {precTriu,precDiag.^-1};</span><br/>               <span style="color: #A0A0A0"> 882</span> <span style="color: #228B22; background: #FFFFFF;">                else</span><br/>               <span style="color: #A0A0A0"> 883</span> <span style="color: #228B22; background: #FFFFFF;">                    % Incomplete Cholesky Preconditioner</span><br/>               <span style="color: #A0A0A0"> 884</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    opts.droptol = -cgSolve;</span><br/>               <span style="color: #A0A0A0"> 885</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    opts.rdiag = 1;</span><br/><a name="Line886"></a>               <span style="color: #A0A0A0"> 886</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    R = cholinc(sparse(H),opts);</span><br/>               <span style="color: #A0A0A0"> 887</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    if min(diag(R)) &lt; 1e-12</span><br/><a name="Line888"></a>               <span style="color: #A0A0A0"> 888</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        R = cholinc(sparse(H + eye*(1e-12 - min(diag(R)))),opts);</span><br/>               <span style="color: #A0A0A0"> 889</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/>               <span style="color: #A0A0A0"> 890</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    precondFunc = @precondTriu;</span><br/>               <span style="color: #A0A0A0"> 891</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    precondArgs = {R};</span><br/>               <span style="color: #A0A0A0"> 892</span> <span style="color: #A0A0A0; background: #FFFFFF;">                end</span><br/>               <span style="color: #A0A0A0"> 893</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 894</span> <span style="color: #228B22; background: #FFFFFF;">                % Run cg with the appropriate preconditioner</span><br/>               <span style="color: #A0A0A0"> 895</span> <span style="color: #A0A0A0; background: #FFFFFF;">                if isempty(HvFunc)</span><br/>               <span style="color: #A0A0A0"> 896</span> <span style="color: #228B22; background: #FFFFFF;">                    % No user-supplied Hessian-vector function</span><br/>               <span style="color: #A0A0A0"> 897</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    [d,cgIter,cgRes] = conjGrad(H,-g,cgForce,cgMaxIter,debug,precondFunc,precondArgs);</span><br/>               <span style="color: #A0A0A0"> 898</span> <span style="color: #228B22; background: #FFFFFF;">                else</span><br/>               <span style="color: #A0A0A0"> 899</span> <span style="color: #228B22; background: #FFFFFF;">                    % Use user-supplied Hessian-vector function</span><br/><a name="Line900"></a>               <span style="color: #A0A0A0"> 900</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    [d,cgIter,cgRes] = conjGrad(H,-g,cgForce,cgMaxIter,debug,precondFunc,precondArgs,HvFunc,{x,varargin{:}});</span><br/>               <span style="color: #A0A0A0"> 901</span> <span style="color: #A0A0A0; background: #FFFFFF;">                end</span><br/>               <span style="color: #A0A0A0"> 902</span> <span style="color: #A0A0A0; background: #FFFFFF;">                if debug</span><br/>               <span style="color: #A0A0A0"> 903</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    fprintf('CG stopped after %d iterations w/ residual %.5e\n',cgIter,cgRes);</span><br/>               <span style="color: #A0A0A0"> 904</span> <span style="color: #228B22; background: #FFFFFF;">                    %funEvals = funEvals + cgIter;</span><br/>               <span style="color: #A0A0A0"> 905</span> <span style="color: #A0A0A0; background: #FFFFFF;">                end</span><br/>               <span style="color: #A0A0A0"> 906</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 907</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 908</span> <span style="color: #A0A0A0; background: #FFFFFF;">        case TENSOR % Tensor Method</span><br/>               <span style="color: #A0A0A0"> 909</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 910</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if numDiff</span><br/>               <span style="color: #A0A0A0"> 911</span> <span style="color: #228B22; background: #FFFFFF;">                % Compute 3rd-order Tensor Numerically</span><br/><a name="Line912"></a>               <span style="color: #A0A0A0"> 912</span> <span style="color: #A0A0A0; background: #FFFFFF;">                [junk1 junk2 junk3 T] = autoTensor(x,useComplex,funObj,varargin{:});</span><br/>               <span style="color: #A0A0A0"> 913</span> <span style="color: #228B22; background: #FFFFFF;">            else</span><br/>               <span style="color: #A0A0A0"> 914</span> <span style="color: #228B22; background: #FFFFFF;">                % Use user-supplied 3rd-derivative Tensor</span><br/><a name="Line915"></a>               <span style="color: #A0A0A0"> 915</span> <span style="color: #A0A0A0; background: #FFFFFF;">                [junk1 junk2 junk3 T] = feval(funObj, x, varargin{:});</span><br/>               <span style="color: #A0A0A0"> 916</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 917</span> <span style="color: #A0A0A0; background: #FFFFFF;">            options_sub.Method = 'newton';</span><br/>               <span style="color: #A0A0A0"> 918</span> <span style="color: #A0A0A0; background: #FFFFFF;">            options_sub.Display = 'none';</span><br/>               <span style="color: #A0A0A0"> 919</span> <span style="color: #A0A0A0; background: #FFFFFF;">            options_sub.TolX = tolX;</span><br/>               <span style="color: #A0A0A0"> 920</span> <span style="color: #A0A0A0; background: #FFFFFF;">            options_sub.TolFun = tolFun;</span><br/>               <span style="color: #A0A0A0"> 921</span> <span style="color: #A0A0A0; background: #FFFFFF;">            d = minFunc(@taylorModel,zeros(p,1),options_sub,f,g,H,T);</span><br/>               <span style="color: #A0A0A0"> 922</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 923</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if any(abs(d) &gt; 1e5) || all(abs(d) &lt; 1e-5) || g'*d &gt; -tolX</span><br/>               <span style="color: #A0A0A0"> 924</span> <span style="color: #A0A0A0; background: #FFFFFF;">                if debug</span><br/>               <span style="color: #A0A0A0"> 925</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    fprintf('Using 2nd-Order Step\n');</span><br/>               <span style="color: #A0A0A0"> 926</span> <span style="color: #A0A0A0; background: #FFFFFF;">                end</span><br/>               <span style="color: #A0A0A0"> 927</span> <span style="color: #A0A0A0; background: #FFFFFF;">                [V,D] = eig((H+H')/2);</span><br/>               <span style="color: #A0A0A0"> 928</span> <span style="color: #A0A0A0; background: #FFFFFF;">                D = diag(D);</span><br/>               <span style="color: #A0A0A0"> 929</span> <span style="color: #A0A0A0; background: #FFFFFF;">                D = max(abs(D),max(max(abs(D)),1)*1e-12);</span><br/>               <span style="color: #A0A0A0"> 930</span> <span style="color: #A0A0A0; background: #FFFFFF;">                d = -V*((V'*g)./D);</span><br/>               <span style="color: #A0A0A0"> 931</span> <span style="color: #228B22; background: #FFFFFF;">            else</span><br/>               <span style="color: #A0A0A0"> 932</span> <span style="color: #A0A0A0; background: #FFFFFF;">                if debug</span><br/>               <span style="color: #A0A0A0"> 933</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    fprintf('Using 3rd-Order Step\n');</span><br/>               <span style="color: #A0A0A0"> 934</span> <span style="color: #A0A0A0; background: #FFFFFF;">                end</span><br/>               <span style="color: #A0A0A0"> 935</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 936</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 937</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">  0.70 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold"> 938</span> <a name="Line938"></a><span style="color: #000000; background: #FFFFFF;">    if ~<a href="file55.html">isLegal</a>(d) </span><br/>               <span style="color: #A0A0A0"> 939</span> <span style="color: #A0A0A0; background: #FFFFFF;">        fprintf('Step direction is illegal!\n');</span><br/>               <span style="color: #A0A0A0"> 940</span> <span style="color: #A0A0A0; background: #FFFFFF;">        pause;</span><br/>               <span style="color: #A0A0A0"> 941</span> <span style="color: #A0A0A0; background: #FFFFFF;">        return</span><br/>               <span style="color: #A0A0A0"> 942</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 943</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 944</span> <span style="color: #228B22; background: #FFFFFF;">    % ****************** COMPUTE STEP LENGTH ************************</span><br/>               <span style="color: #A0A0A0"> 945</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 946</span> <span style="color: #228B22; background: #FFFFFF;">    % Directional Derivative</span><br/><span style="color: #FF0000">  0.11 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold"> 947</span> <span style="color: #000000; background: #FFFFFF;">    gtd = g'*d; </span><br/>               <span style="color: #A0A0A0"> 948</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 949</span> <span style="color: #228B22; background: #FFFFFF;">    % Check that progress can be made along direction</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold"> 950</span> <span style="color: #000000; background: #FFFFFF;">    if gtd &gt; -tolX </span><br/>               <span style="color: #A0A0A0"> 951</span> <span style="color: #A0A0A0; background: #FFFFFF;">        exitflag=2;</span><br/>               <span style="color: #A0A0A0"> 952</span> <span style="color: #A0A0A0; background: #FFFFFF;">        msg = 'Directional Derivative below TolX';</span><br/>               <span style="color: #A0A0A0"> 953</span> <span style="color: #A0A0A0; background: #FFFFFF;">        break;</span><br/>               <span style="color: #A0A0A0"> 954</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 955</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 956</span> <span style="color: #228B22; background: #FFFFFF;">    % Select Initial Guess</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold"> 957</span> <span style="color: #000000; background: #FFFFFF;">    if i == 1 </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 958</span> <span style="color: #000000; background: #FFFFFF;">        if method &lt; NEWTON0 </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 959</span> <span style="color: #000000; background: #FFFFFF;">            t = min(1,1/sum(abs(g))); </span><br/>               <span style="color: #A0A0A0"> 960</span> <span style="color: #228B22; background: #FFFFFF;">        else</span><br/>               <span style="color: #A0A0A0"> 961</span> <span style="color: #A0A0A0; background: #FFFFFF;">            t = 1;</span><br/>               <span style="color: #A0A0A0"> 962</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>       <span style="color: #0000FF">    399 </span><span style="color: #000000; font-weight: bold"> 963</span> <span style="color: #228B22; background: #FFFFFF;">    else </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    399 </span><span style="color: #000000; font-weight: bold"> 964</span> <span style="color: #000000; background: #FFFFFF;">        if LS_init == 0 </span><br/>               <span style="color: #A0A0A0"> 965</span> <span style="color: #228B22; background: #FFFFFF;">            % Newton step</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    399 </span><span style="color: #000000; font-weight: bold"> 966</span> <span style="color: #000000; background: #FFFFFF;">            t = 1; </span><br/>               <span style="color: #A0A0A0"> 967</span> <span style="color: #A0A0A0; background: #FFFFFF;">        elseif LS_init == 1</span><br/>               <span style="color: #A0A0A0"> 968</span> <span style="color: #228B22; background: #FFFFFF;">            % Close to previous step length</span><br/>               <span style="color: #A0A0A0"> 969</span> <span style="color: #A0A0A0; background: #FFFFFF;">            t = t*min(2,(gtd_old)/(gtd));</span><br/>               <span style="color: #A0A0A0"> 970</span> <span style="color: #A0A0A0; background: #FFFFFF;">        elseif LS_init == 2</span><br/>               <span style="color: #A0A0A0"> 971</span> <span style="color: #228B22; background: #FFFFFF;">            % Quadratic Initialization based on {f,g} and previous f</span><br/>               <span style="color: #A0A0A0"> 972</span> <span style="color: #A0A0A0; background: #FFFFFF;">            t = min(1,2*(f-f_old)/(gtd));</span><br/>               <span style="color: #A0A0A0"> 973</span> <span style="color: #A0A0A0; background: #FFFFFF;">        elseif LS_init == 3</span><br/>               <span style="color: #A0A0A0"> 974</span> <span style="color: #228B22; background: #FFFFFF;">            % Double previous step length</span><br/>               <span style="color: #A0A0A0"> 975</span> <span style="color: #A0A0A0; background: #FFFFFF;">            t = min(1,t*2);</span><br/>               <span style="color: #A0A0A0"> 976</span> <span style="color: #A0A0A0; background: #FFFFFF;">        elseif LS_init == 4</span><br/>               <span style="color: #A0A0A0"> 977</span> <span style="color: #228B22; background: #FFFFFF;">            % Scaled step length if possible</span><br/>               <span style="color: #A0A0A0"> 978</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if isempty(HvFunc)</span><br/>               <span style="color: #A0A0A0"> 979</span> <span style="color: #228B22; background: #FFFFFF;">                % No user-supplied Hessian-vector function,</span><br/>               <span style="color: #A0A0A0"> 980</span> <span style="color: #228B22; background: #FFFFFF;">                % use automatic differentiation</span><br/>               <span style="color: #A0A0A0"> 981</span> <span style="color: #A0A0A0; background: #FFFFFF;">                dHd = d'*autoHv(d,x,g,0,funObj,varargin{:});</span><br/>               <span style="color: #A0A0A0"> 982</span> <span style="color: #228B22; background: #FFFFFF;">            else</span><br/>               <span style="color: #A0A0A0"> 983</span> <span style="color: #228B22; background: #FFFFFF;">                % Use user-supplid Hessian-vector function</span><br/>               <span style="color: #A0A0A0"> 984</span> <span style="color: #A0A0A0; background: #FFFFFF;">                dHd = d'*HvFunc(d,x,varargin{:});</span><br/>               <span style="color: #A0A0A0"> 985</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 986</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 987</span> <span style="color: #A0A0A0; background: #FFFFFF;">            funEvals = funEvals + 1;</span><br/>               <span style="color: #A0A0A0"> 988</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if dHd &gt; 0</span><br/>               <span style="color: #A0A0A0"> 989</span> <span style="color: #A0A0A0; background: #FFFFFF;">                t = -gtd/(dHd);</span><br/>               <span style="color: #A0A0A0"> 990</span> <span style="color: #228B22; background: #FFFFFF;">            else</span><br/>               <span style="color: #A0A0A0"> 991</span> <span style="color: #A0A0A0; background: #FFFFFF;">                t = min(1,2*(f-f_old)/(gtd));</span><br/>               <span style="color: #A0A0A0"> 992</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 993</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0"> 994</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">    399 </span><span style="color: #000000; font-weight: bold"> 995</span> <span style="color: #000000; background: #FFFFFF;">        if t &lt;= 0 </span><br/>               <span style="color: #A0A0A0"> 996</span> <span style="color: #A0A0A0; background: #FFFFFF;">            t = 1;</span><br/>               <span style="color: #A0A0A0"> 997</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    399 </span><span style="color: #000000; font-weight: bold"> 998</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/><a name="Line999"></a>       <span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold"> 999</span> <span style="color: #000000; background: #FFFFFF;">    f_old = f; </span><br/>       <span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold">1000</span> <span style="color: #000000; background: #FFFFFF;">    gtd_old = gtd; </span><br/>               <span style="color: #A0A0A0">1001</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">1002</span> <span style="color: #228B22; background: #FFFFFF;">    % Compute reference fr if using non-monotone objective</span><br/>       <span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold">1003</span> <span style="color: #000000; background: #FFFFFF;">    if Fref == 1 </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold">1004</span> <span style="color: #000000; background: #FFFFFF;">        fr = f; </span><br/>               <span style="color: #A0A0A0">1005</span> <span style="color: #228B22; background: #FFFFFF;">    else</span><br/>               <span style="color: #A0A0A0">1006</span> <span style="color: #A0A0A0; background: #FFFFFF;">        if i == 1</span><br/>               <span style="color: #A0A0A0">1007</span> <span style="color: #A0A0A0; background: #FFFFFF;">            old_fvals = repmat(-inf,[Fref 1]);</span><br/>               <span style="color: #A0A0A0">1008</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0">1009</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">1010</span> <span style="color: #A0A0A0; background: #FFFFFF;">        if i &lt;= Fref</span><br/>               <span style="color: #A0A0A0">1011</span> <span style="color: #A0A0A0; background: #FFFFFF;">            old_fvals(i) = f;</span><br/>               <span style="color: #A0A0A0">1012</span> <span style="color: #228B22; background: #FFFFFF;">        else</span><br/>               <span style="color: #A0A0A0">1013</span> <span style="color: #A0A0A0; background: #FFFFFF;">            old_fvals = [old_fvals(2:end);f];</span><br/>               <span style="color: #A0A0A0">1014</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0">1015</span> <span style="color: #A0A0A0; background: #FFFFFF;">        fr = max(old_fvals);</span><br/>               <span style="color: #A0A0A0">1016</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0">1017</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold">1018</span> <span style="color: #000000; background: #FFFFFF;">    computeHessian = 0; </span><br/>       <span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold">1019</span> <span style="color: #000000; background: #FFFFFF;">    if method &gt;= NEWTON </span><br/>               <span style="color: #A0A0A0">1020</span> <span style="color: #A0A0A0; background: #FFFFFF;">        if HessianIter == 1</span><br/>               <span style="color: #A0A0A0">1021</span> <span style="color: #A0A0A0; background: #FFFFFF;">            computeHessian = 1;</span><br/>               <span style="color: #A0A0A0">1022</span> <span style="color: #A0A0A0; background: #FFFFFF;">        elseif i &gt; 1 &amp;&amp; mod(i-1,HessianIter) == 0</span><br/>               <span style="color: #A0A0A0">1023</span> <span style="color: #A0A0A0; background: #FFFFFF;">            computeHessian = 1;</span><br/>               <span style="color: #A0A0A0">1024</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0">1025</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0">1026</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">1027</span> <span style="color: #228B22; background: #FFFFFF;">    % Line Search</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold">1028</span> <span style="color: #000000; background: #FFFFFF;">    f_old = f; </span><br/>       <span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold">1029</span> <span style="color: #000000; background: #FFFFFF;">    if LS &lt; 3 % Use Armijo Bactracking </span><br/>               <span style="color: #A0A0A0">1030</span> <span style="color: #228B22; background: #FFFFFF;">        % Perform Backtracking line search</span><br/>               <span style="color: #A0A0A0">1031</span> <span style="color: #A0A0A0; background: #FFFFFF;">        if computeHessian</span><br/>               <span style="color: #A0A0A0">1032</span> <span style="color: #A0A0A0; background: #FFFFFF;">            [t,x,f,g,LSfunEvals,H] = ArmijoBacktrack(x,t,d,f,fr,g,gtd,c1,LS,tolX,debug,doPlot,LS_saveHessianComp,funObj,varargin{:});</span><br/>               <span style="color: #A0A0A0">1033</span> <span style="color: #228B22; background: #FFFFFF;">        else</span><br/>               <span style="color: #A0A0A0">1034</span> <span style="color: #A0A0A0; background: #FFFFFF;">            [t,x,f,g,LSfunEvals] = ArmijoBacktrack(x,t,d,f,fr,g,gtd,c1,LS,tolX,debug,doPlot,1,funObj,varargin{:});</span><br/>               <span style="color: #A0A0A0">1035</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0">1036</span> <span style="color: #A0A0A0; background: #FFFFFF;">        funEvals = funEvals + LSfunEvals;</span><br/>               <span style="color: #A0A0A0">1037</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold">1038</span> <span style="color: #000000; background: #FFFFFF;">    elseif LS &lt; 6 </span><br/>               <span style="color: #A0A0A0">1039</span> <span style="color: #228B22; background: #FFFFFF;">        % Find Point satisfying Wolfe</span><br/>               <span style="color: #A0A0A0">1040</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold">1041</span> <span style="color: #000000; background: #FFFFFF;">        if computeHessian </span><br/>               <span style="color: #A0A0A0">1042</span> <span style="color: #A0A0A0; background: #FFFFFF;">            [t,f,g,LSfunEvals,H] = WolfeLineSearch(x,t,d,f,g,gtd,c1,c2,LS,25,tolX,debug,doPlot,LS_saveHessianComp,funObj,varargin{:});</span><br/>       <span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold">1043</span> <span style="color: #228B22; background: #FFFFFF;">        else </span><br/><span style="color: #FF0000"> 1874.19 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold">1044</span> <a name="Line1044"></a><span style="color: #000000; background: #FF8080;">            [t,f,g,LSfunEvals] = <a href="file54.html">WolfeLineSearch</a>(x,t,d,f,g,gtd,c1,c2,LS,25,tolX,debug,doPlot,1,funObj,varargin{:}); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold">1045</span> <span style="color: #000000; background: #FFFFFF;">        end </span><br/>       <span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold">1046</span> <span style="color: #000000; background: #FFFFFF;">        funEvals = funEvals + LSfunEvals; </span><br/><span style="color: #FF0000">  0.18 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold">1047</span> <span style="color: #000000; background: #FFFFFF;">        x = x + t*d; </span><br/>               <span style="color: #A0A0A0">1048</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">1049</span> <span style="color: #228B22; background: #FFFFFF;">    else</span><br/>               <span style="color: #A0A0A0">1050</span> <span style="color: #228B22; background: #FFFFFF;">        % Use Matlab optim toolbox line search</span><br/><a name="Line1051"></a>               <span style="color: #A0A0A0">1051</span> <span style="color: #A0A0A0; background: #FFFFFF;">        [t,f_new,fPrime_new,g_new,LSexitFlag,LSiter]=...</span><br/>               <span style="color: #A0A0A0">1052</span> <span style="color: #A0A0A0; background: #FFFFFF;">            lineSearch({'fungrad',[],funObj},x,p,1,p,d,f,gtd,t,c1,c2,-inf,maxFunEvals-funEvals,...</span><br/>               <span style="color: #A0A0A0">1053</span> <span style="color: #A0A0A0; background: #FFFFFF;">            tolX,[],[],[],varargin{:});</span><br/>               <span style="color: #A0A0A0">1054</span> <span style="color: #A0A0A0; background: #FFFFFF;">        funEvals = funEvals + LSiter;</span><br/>               <span style="color: #A0A0A0">1055</span> <span style="color: #A0A0A0; background: #FFFFFF;">        if isempty(t)</span><br/>               <span style="color: #A0A0A0">1056</span> <span style="color: #A0A0A0; background: #FFFFFF;">            exitflag = -2;</span><br/>               <span style="color: #A0A0A0">1057</span> <span style="color: #A0A0A0; background: #FFFFFF;">            msg = 'Matlab LineSearch failed';</span><br/>               <span style="color: #A0A0A0">1058</span> <span style="color: #A0A0A0; background: #FFFFFF;">            break;</span><br/>               <span style="color: #A0A0A0">1059</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0">1060</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">1061</span> <span style="color: #A0A0A0; background: #FFFFFF;">        if method &gt;= NEWTON</span><br/>               <span style="color: #A0A0A0">1062</span> <span style="color: #A0A0A0; background: #FFFFFF;">            [f_new,g_new,H] = funObj(x + t*d,varargin{:});</span><br/>               <span style="color: #A0A0A0">1063</span> <span style="color: #A0A0A0; background: #FFFFFF;">            funEvals = funEvals + 1;</span><br/>               <span style="color: #A0A0A0">1064</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0">1065</span> <span style="color: #A0A0A0; background: #FFFFFF;">        x = x + t*d;</span><br/>               <span style="color: #A0A0A0">1066</span> <span style="color: #A0A0A0; background: #FFFFFF;">        f = f_new;</span><br/>               <span style="color: #A0A0A0">1067</span> <span style="color: #A0A0A0; background: #FFFFFF;">        g = g_new;</span><br/>               <span style="color: #A0A0A0">1068</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0">1069</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">1070</span> <span style="color: #228B22; background: #FFFFFF;">    % Output iteration information</span><br/>       <span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold">1071</span> <span style="color: #000000; background: #FFFFFF;">    if verboseI </span><br/><span style="color: #FF0000">  0.55 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold">1072</span> <span style="color: #000000; background: #FFFFFF;">        fprintf('%10d %10d %15.5e %15.5e %15.5e\n',i,funEvals*funEvalMultiplier,t,f,sum(abs(g))); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold">1073</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/>               <span style="color: #A0A0A0">1074</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold">1075</span> <span style="color: #000000; background: #FFFFFF;">    if logfile </span><br/>               <span style="color: #A0A0A0">1076</span> <span style="color: #A0A0A0; background: #FFFFFF;">        fid = fopen(logfile, 'a');</span><br/>               <span style="color: #A0A0A0">1077</span> <span style="color: #A0A0A0; background: #FFFFFF;">        if (fid &gt; 0)</span><br/>               <span style="color: #A0A0A0">1078</span> <span style="color: #A0A0A0; background: #FFFFFF;">            fprintf(fid, '-- %10d %10d %15.5e %15.5e %15.5e\n',i,funEvals*funEvalMultiplier,t,f,sum(abs(g)));</span><br/>               <span style="color: #A0A0A0">1079</span> <span style="color: #A0A0A0; background: #FFFFFF;">            fclose(fid);</span><br/>               <span style="color: #A0A0A0">1080</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0">1081</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0">1082</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">1083</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>               <span style="color: #A0A0A0">1084</span> <span style="color: #228B22; background: #FFFFFF;">    % Output Function</span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold">1085</span> <span style="color: #000000; background: #FFFFFF;">    if ~isempty(outputFcn) </span><br/>               <span style="color: #A0A0A0">1086</span> <span style="color: #A0A0A0; background: #FFFFFF;">        callOutput(outputFcn,x,'iter',i,funEvals,f,t,gtd,g,d,sum(abs(g)),varargin{:});</span><br/>               <span style="color: #A0A0A0">1087</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0">1088</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">1089</span> <span style="color: #228B22; background: #FFFFFF;">    % Update Trace</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold">1090</span> <span style="color: #000000; background: #FFFFFF;">    trace.fval(end+1,1) = f; </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold">1091</span> <span style="color: #000000; background: #FFFFFF;">    trace.funcCount(end+1,1) = funEvals; </span><br/>               <span style="color: #A0A0A0">1092</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">1093</span> <span style="color: #228B22; background: #FFFFFF;">    % Check Optimality Condition</span><br/><span style="color: #FF0000">  0.47 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold">1094</span> <span style="color: #000000; background: #FFFFFF;">    if sum(abs(g)) &lt;= tolFun </span><br/>               <span style="color: #A0A0A0">1095</span> <span style="color: #A0A0A0; background: #FFFFFF;">        exitflag=1;</span><br/>               <span style="color: #A0A0A0">1096</span> <span style="color: #A0A0A0; background: #FFFFFF;">        msg = 'Optimality Condition below TolFun';</span><br/>               <span style="color: #A0A0A0">1097</span> <span style="color: #A0A0A0; background: #FFFFFF;">        break;</span><br/>               <span style="color: #A0A0A0">1098</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0">1099</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">1100</span> <span style="color: #228B22; background: #FFFFFF;">    % ******************* Check for lack of progress *******************</span><br/>               <span style="color: #A0A0A0">1101</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">  0.50 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold">1102</span> <span style="color: #000000; background: #FFFFFF;">    if sum(abs(t*d)) &lt;= tolX </span><br/>               <span style="color: #A0A0A0">1103</span> <span style="color: #A0A0A0; background: #FFFFFF;">        exitflag=2;</span><br/>               <span style="color: #A0A0A0">1104</span> <span style="color: #A0A0A0; background: #FFFFFF;">        msg = 'Step Size below TolX';</span><br/>               <span style="color: #A0A0A0">1105</span> <span style="color: #A0A0A0; background: #FFFFFF;">        break;</span><br/>               <span style="color: #A0A0A0">1106</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0">1107</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">1108</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold">1109</span> <span style="color: #000000; background: #FFFFFF;">    if abs(f-f_old) &lt; tolX </span><br/>               <span style="color: #A0A0A0">1110</span> <span style="color: #A0A0A0; background: #FFFFFF;">        exitflag=2;</span><br/>               <span style="color: #A0A0A0">1111</span> <span style="color: #A0A0A0; background: #FFFFFF;">        msg = 'Function Value changing by less than TolX';</span><br/>               <span style="color: #A0A0A0">1112</span> <span style="color: #A0A0A0; background: #FFFFFF;">        break;</span><br/>               <span style="color: #A0A0A0">1113</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0">1114</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">1115</span> <span style="color: #228B22; background: #FFFFFF;">    % ******** Check for going over iteration/evaluation limit *******************</span><br/>               <span style="color: #A0A0A0">1116</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold">1117</span> <span style="color: #000000; background: #FFFFFF;">    if funEvals*funEvalMultiplier &gt; maxFunEvals </span><br/>               <span style="color: #A0A0A0">1118</span> <span style="color: #A0A0A0; background: #FFFFFF;">        exitflag = 0;</span><br/>               <span style="color: #A0A0A0">1119</span> <span style="color: #A0A0A0; background: #FFFFFF;">        msg = 'Exceeded Maximum Number of Function Evaluations';</span><br/>               <span style="color: #A0A0A0">1120</span> <span style="color: #A0A0A0; background: #FFFFFF;">        break;</span><br/>               <span style="color: #A0A0A0">1121</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0">1122</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    400 </span><span style="color: #000000; font-weight: bold">1123</span> <span style="color: #000000; background: #FFFFFF;">    if i == maxIter </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">1124</span> <span style="color: #000000; background: #FFFFFF;">        exitflag = 0; </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">1125</span> <span style="color: #000000; background: #FFFFFF;">        msg='Exceeded Maximum Number of Iterations'; </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">1126</span> <span style="color: #000000; background: #FFFFFF;">        break; </span><br/>               <span style="color: #A0A0A0">1127</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0">1128</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    399 </span><span style="color: #000000; font-weight: bold">1129</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0">1130</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">1131</span> <span style="color: #000000; background: #FFFFFF;">if verbose </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">1132</span> <span style="color: #000000; background: #FFFFFF;">    fprintf('%s\n',msg); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">1133</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">1134</span> <span style="color: #000000; background: #FFFFFF;">if nargout &gt; 3 </span><br/>               <span style="color: #A0A0A0">1135</span> <span style="color: #A0A0A0; background: #FFFFFF;">    output = struct('iterations',i,'funcCount',funEvals*funEvalMultiplier,...</span><br/>               <span style="color: #A0A0A0">1136</span> <span style="color: #A0A0A0; background: #FFFFFF;">        'algorithm',method,'firstorderopt',sum(abs(g)),'message',msg,'trace',trace);</span><br/>               <span style="color: #A0A0A0">1137</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0">1138</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">1139</span> <span style="color: #228B22; background: #FFFFFF;">% Output Function</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">1140</span> <span style="color: #000000; background: #FFFFFF;">if ~isempty(outputFcn) </span><br/>               <span style="color: #A0A0A0">1141</span> <span style="color: #A0A0A0; background: #FFFFFF;">    callOutput(outputFcn,x,'done',i,funEvals,f,t,gtd,g,d,sum(abs(g)),varargin{:});</span><br/>               <span style="color: #A0A0A0">1142</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0">1143</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">1144</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/></pre><p><p>Other subfunctions in this file are not included in this listing.</body></html>